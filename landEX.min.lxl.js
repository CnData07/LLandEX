/*
=======================================
                LandEX
          Copyright@xmmpps
=======================================
 */
logger.setTitle("LandEX"),logger.setConsole(!0,4),file.exists("./plugins/js_data/landEX/")||(log("首次运行，创建文件夹"),file.mkdir("./plugins/js_data/landEX/"));const configAPI={data:{economy:{useLLmoney:!1,moneyScoreboard:"coin",moneyName:"祭点"},sell:{type3D:{priceXZ:2,priceY:1},type2D:{priceSquare:200}},refund:{enable:!0,rate:.9},common:{language:"zh-cn",allow3D:!0,allow2D:!0,useOrgnization:!0,allowLandTeleport:!0,useDrawLine:!0,tickRate:1e3,enableCache:!0,cacheSize:512},limit:{allowDimension:[0,1,2],type2DSquare:[10,1e4],type3DVolume:[100,384e4]},operator:[]},save(){file.writeTo("./plugins/js_data/landEX/config.json",data.toJson(this.data,4))},reload(){this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/config.json"))}},i18n=(file.exists("./plugins/js_data/landEX/config.json")?configAPI.reload():configAPI.save(),{data:{},$t(e,n=[]){if(!this.data[e])return"Translate Error";let t=this.data[e];for(let e=0;e<n.length;e++){var a=n[e];t=t.replace("%s",a)}return t},reload(){file.exists("./plugins/js_data/landEX/i18n/"+configAPI.data.common.language+".json")&&(i18n.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/i18n/"+configAPI.data.common.language+".json")))}}),moneyUni=(file.exists("./plugins/js_data/landEX/i18n/"+configAPI.data.common.language+".json")&&(i18n.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/i18n/"+configAPI.data.common.language+".json"))),{offlineMoney:new KVDatabase("./plugins/js_data/landEX/offlineMoney/"),get(e){return configAPI.data.economy.useLLmoney?money.get(e.xuid):e.getScore(configAPI.data.economy.moneyScoreboard)},pay(e,n){return!(this.get(e)<n)&&(configAPI.data.economy.useLLmoney?money.reduce(e.xuid,n):e.reduceScore(configAPI.data.economy.moneyScoreboard,n))},addMoney(n,t){if(configAPI.data.economy.useLLmoney)return money.add(n,t);{let e=mc.getPlayer(n);var a;return e?e.addScore(configAPI.data.economy.moneyScoreboard,t):(a=this.offlineMoney.get(n)||0,this.offlineMoney.set(n,a+t))}}});let enableOrg=configAPI.data.common.useOrgnization&&ll.require("organizationEX.js"),enableDrawLine=configAPI.data.common.useDrawLine&&ll.require("draw-line.lxl.js");const orgAPI={getOrgNum:ll.import("orgEX_getPlayerOrgNum"),isOwner:ll.import("orgEX_playerIsOwner"),orgGetMoney:ll.import("orgEX_orgGetMoney"),orgAddMoney:ll.import("orgEX_orgAddMoney"),getOrgName:ll.import("orgEX_getOrgName")},belongToApi=(orgAPI.getOrgNum,{data:{player:{},shared:{},org:{}},playerAddLand(e,n){return this.data.player[e.xuid]?!this.data.player[e.xuid].includes(n)&&(this.data.player[e.xuid].push(n),!0):(this.data.player[e.xuid]=[n],!0)},playerAddShare(e,n){return this.data.shared[e.xuid]?!this.data.shared[e.xuid].includes(n)&&(this.data.shared[e.xuid].push(n),!0):(this.data.shared[e.xuid]=[n],!0)},orgAddLand(e,n){return this.data.org[e]?!this.data.org[e].includes(n)&&(this.data.org[e].push(n),!0):(this.data.org[e]=[n],!0)},playerRemoveShare(e,n){return!(!this.data.shared[e]||!this.data.shared[e].includes(n))&&(this.data.shared[e].splice(!this.data.shared[e].indexOf(n),1),!0)},playerRemoveLand(e,n){return!(!this.data.player[e]||!this.data.player[e].includes(n))&&(this.data.player[e].splice(!this.data.player[e].indexOf(n),1),!0)},orgRemoveLand(e,n){return!(!this.data.org[e]||!this.data.org[e].includes(n))&&(this.data.org[e].splice(!this.data.org[e].indexOf(n),1),!0)},getLand(e="",n=""){return e?this.data.player[e]||[]:n&&this.data.org[n]||[]},save(){file.writeTo("./plugins/js_data/landEX/owner.json",data.toJson(this.data,4))},reload(){this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/owner.json"))}}),pLandDataInterface=(file.exists("./plugins/js_data/landEX/owner.json")?belongToApi.reload():belongToApi.save(),{data:{},save(){file.writeTo("./plugins/js_data/landEX/priviteLandData.json",data.toJson(this.data,4))},load(){this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/priviteLandData.json"))},isPosInLand(e,n,t,a,i){if(!this.data[i])return!1;i=this.data[i];return i.range.dimid===a&&(i.range.type2D?e>=i.range.min_position[0]&&e<=i.range.max_position[0]&&t>=i.range.min_position[2]&&t<=i.range.max_position[2]:e>=i.range.min_position[0]&&e<=i.range.max_position[0]&&t>=i.range.min_position[2]&&t<=i.range.max_position[2]&&n>=i.range.min_position[1]&&n<=i.range.max_position[1])},isRangeInLand(e,n,t=!1,a){if(!this.data[a])return logger.debug("领地不存在"),!1;a=this.data[a];return a.range.dimid!==n?(logger.debug("维度不对"),!1):e.maxX<a.range.min_position[0]||e.minX>a.range.max_position[0]?(logger.debug("X轴没有冲突"),!1):e.maxZ<a.range.min_position[2]||e.minZ>a.range.max_position[2]?(logger.debug("Z轴没有冲突"),!1):!(!t&&!a.range.type2D&&(e.maxY<a.range.min_position[1]||e.minY>a.range.max_position[1]))||(logger.debug("Y轴没有冲突"),!1)},inTrust(e,n){return!this.data[n]||!(this.data[n].settings.owner!==e&&!this.data[n].share.includes(e))}}),OlandDataInterface=(file.exists("./plugins/js_data/landEX/priviteLandData.json")?pLandDataInterface.load():pLandDataInterface.save(),{data:{},save(){file.writeTo("./plugins/js_data/landEX/orgLandData.json",data.toJson(this.data,4))},load(){this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/orgLandData.json"))},isPosInLand(e,n,t,a,i){if(!this.data[i])return!1;i=this.data[i];return i.range.dimid===a&&(i.range.type2D?e>=i.range.min_position[0]&&e<=i.range.max_position[0]&&t>=i.range.min_position[2]&&t<=i.range.max_position[2]:e>=i.range.min_position[0]&&e<=i.range.max_position[0]&&t>=i.range.min_position[2]&&t<=i.range.max_position[2]&&n>=i.range.min_position[1]&&n<=i.range.max_position[1])},isRangeInLand(e,n,t=!1,a){if(!this.data[a])return logger.debug("领地不存在"),!1;a=this.data[a];return a.range.dimid!==n?(logger.debug("维度不对"),!1):e.maxX<a.range.min_position[0]||e.minX>a.range.max_position[0]?(logger.debug("X轴没有冲突"),!1):e.maxZ<a.range.min_position[2]||e.minZ>a.range.max_position[2]?(logger.debug("Z轴没有冲突"),!1):!(!t&&!a.range.type2D&&(e.maxY<a.range.min_position[1]||e.minY>a.range.max_position[1]))||(logger.debug("Y轴没有冲突"),!1)},inTrust(e,n){if(!this.data[n])return!0;var t=orgAPI.getOrgNum(e);return this.data[n].settings.owner===t&&(!!orgAPI.isOwner(e)||!!this.data[n].permissions.organization.trustMembers)}}),ChunkInterface=(file.exists("./plugins/js_data/landEX/orgLandData.json")?OlandDataInterface.load():OlandDataInterface.save(),{data:{private:[{},{},{}],organization:[{},{},{}]},load(){logger.log("加载缓存的索引表..."),this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/landIndex.json"))},reload(){logger.log("正在构建索引表...");let t=0;for(const s in pLandDataInterface.data)if(Object.hasOwnProperty.call(pLandDataInterface.data,s)){var a=pLandDataInterface.data[s].range,i={minX:Math.floor(a.min_position[0]/16-1),minZ:Math.floor(a.min_position[2]/16-1),maxX:Math.floor(a.max_position[0]/16+1),maxZ:Math.floor(a.max_position[2]/16+1)};for(let n=i.minX;n<i.maxX;n++){this.data.private[a.dimid]["C"+String(n)]||(this.data.private[a.dimid]["C"+String(n)]={});for(let e=i.minZ;e<i.maxZ;e++)this.data.private[a.dimid]["C"+String(n)]["C"+String(e)]||(this.data.private[a.dimid]["C"+String(n)]["C"+String(e)]=[]),this.data.private[a.dimid]["C"+String(n)]["C"+String(e)].push(s),t++}}for(const l in OlandDataInterface.data)if(Object.hasOwnProperty.call(OlandDataInterface.data,l)){var o=OlandDataInterface.data[l].range,r={minX:Math.floor(o.min_position[0]/16-1),minZ:Math.floor(o.min_position[2]/16-1),maxX:Math.floor(o.max_position[0]/16+1),maxZ:Math.floor(o.max_position[2]/16+1)};for(let n=r.minX;n<r.maxX;n++){this.data.organization[o.dimid]["C"+String(n)]||(this.data.organization[o.dimid]["C"+String(n)]={});for(let e=r.minZ;e<r.maxZ;e++)this.data.organization[o.dimid]["C"+String(n)]["C"+String(e)]||(this.data.organization[o.dimid]["C"+String(n)]["C"+String(e)]=[]),this.data.organization[o.dimid]["C"+String(n)]["C"+String(e)].push(l),t++}}logger.log("索引构建完成，共产生"+t+"条数据。")},save(){file.writeTo("./plugins/js_data/landEX/landIndex.json",data.toJson(this.data,4))},unlinkPrivate(e,n,t,a,i,o){var r,s={minX:Math.floor(e/16-1),minZ:Math.floor(t/16-1),maxX:Math.floor(n/16+1),maxZ:Math.floor(a/16+1)};for(let n=s.minX;n<s.maxX;n++)if(this.data.private[i]["C"+String(n)]){for(let e=s.minZ;e<s.maxZ;e++)this.data.private[i]["C"+String(n)]["C"+String(e)]&&(-1!==(r=this.data.private[i]["C"+String(n)]["C"+String(e)].indexOf(o))&&this.data.private[i]["C"+String(n)]["C"+String(e)].splice(r,1),0===this.data.private[i]["C"+String(n)]["C"+String(e)].length&&delete this.data.private[i]["C"+String(n)]["C"+String(e)]);0===Object.keys(this.data.private[i]["C"+String(n)]).length&&delete this.data.private[i]["C"+String(n)]}},unlinkOrg(e,n,t,a,i,o){var r,s={minX:Math.floor(e/16-1),minZ:Math.floor(t/16-1),maxX:Math.floor(n/16+1),maxZ:Math.floor(a/16+1)};for(let n=s.minX;n<s.maxX;n++)if(this.data.organization[i]["C"+String(n)]){for(let e=s.minZ;e<s.maxZ;e++)this.data.organization[i]["C"+String(n)]["C"+String(e)]&&(-1!==(r=this.data.organization[i]["C"+String(n)]["C"+String(e)].indexOf(o))&&this.data.organization[i]["C"+String(n)]["C"+String(e)].splice(r,1),0===this.data.organization[i]["C"+String(n)]["C"+String(e)].length&&delete this.data.organization[i]["C"+String(n)]["C"+String(e)]);0===Object.keys(this.data.organization[i]["C"+String(n)]).length&&delete this.data.organization[i]["C"+String(n)]}},linkPrivate(t){var e=pLandDataInterface.data[t];if(e){var a=e.range,i={minX:Math.floor(a.min_position[0]/16-1),minZ:Math.floor(a.min_position[2]/16-1),maxX:Math.floor(a.max_position[0]/16+1),maxZ:Math.floor(a.max_position[2]/16+1)};for(let n=i.minX;n<i.maxX;n++){this.data.private[a.dimid]["C"+String(n)]||(this.data.private[a.dimid]["C"+String(n)]={});for(let e=i.minZ;e<i.maxZ;e++)this.data.private[a.dimid]["C"+String(n)]["C"+String(e)]||(this.data.private[a.dimid]["C"+String(n)]["C"+String(e)]=[]),this.data.private[a.dimid]["C"+String(n)]["C"+String(e)].push(t)}}},linkOrg(t){var e=OlandDataInterface.data[t];if(e){var a=e.range,i={minX:Math.floor(a.min_position[0]/16-1),minZ:Math.floor(a.min_position[2]/16-1),maxX:Math.floor(a.max_position[0]/16+1),maxZ:Math.floor(a.max_position[2]/16+1)};for(let n=i.minX;n<i.maxX;n++){this.data.organization[a.dimid]["C"+String(n)]||(this.data.organization[a.dimid]["C"+String(n)]={});for(let e=i.minZ;e<i.maxZ;e++)this.data.organization[a.dimid]["C"+String(n)]["C"+String(e)]||(this.data.organization[a.dimid]["C"+String(n)]["C"+String(e)]=[]),this.data.organization[a.dimid]["C"+String(n)]["C"+String(e)].push(t)}}},getChunksLand(e,n,t,a){e=Math.floor(e/16),n=Math.floor(n/16);return logger.debug("尝试以下索引："+e+","+n+","+t),this.data[a?"organization":"private"][t]&&this.data[a?"organization":"private"][t]["C"+String(e)]&&this.data[a?"organization":"private"][t]["C"+String(e)]["C"+String(n)]?this.data[a?"organization":"private"][t]["C"+String(e)]["C"+String(n)]:(logger.debug("索引没有建立，此区块中没有领地"),[])},getChunks(e,n,t,a=!1){return logger.debug("尝试以下索引："+e+","+n+","+t),this.data[a?"organization":"private"][t]&&this.data[a?"organization":"private"][t]["C"+String(e)]&&this.data[a?"organization":"private"][t]["C"+String(e)]["C"+String(n)]?this.data[a?"organization":"private"][t]["C"+String(e)]["C"+String(n)]:(logger.debug("索引没有建立，此区块中没有领地"),[])}}),cache=(configAPI.data.common.enableCache?file.exists("./plugins/js_data/landEX/landIndex.json")?ChunkInterface.load():(ChunkInterface.reload(),ChunkInterface.save()):ChunkInterface.reload(),{data:new Map,sequence:[],push(e,n){for(;this.data.size>=configAPI.data.common.cacheSize;){var t=this.sequence.pop();this.data.delete(t)}this.data.set(e,n);var a=this.sequence.indexOf(e);-1!==a&&this.sequence.splice(a,1),this.sequence.splice(0,0,e),logger.debug("推送了一条索引"+e+":"+n)},try(e){var n=this.sequence.indexOf(e);return-1!==n?(this.sequence.splice(n,1),this.sequence.splice(0,0,e),this.data.get(e)):null},cancel(e){var n=this.sequence.indexOf(e);if(-1!==n)return this.sequence.splice(n,1),this.data.delete(e)},clean(){this.data=new Map,this.sequence=[]}});function getPLandIdbyPos(e,n,t,a){if(configAPI.data.common.enableCache){var i=cache.try("pr:"+e+","+n+","+t+","+a);if("em"===i)return logger.debug("缓存命中:空"),null;if(i)return logger.debug("缓存命中:"+i),i;logger.debug("缓存未命中，查区块索引试试")}for(const o of ChunkInterface.getChunksLand(e,t,a,!1))if(pLandDataInterface.isPosInLand(e,n,t,a,o)){if(logger.debug("区块索引命中："+o),configAPI.data.common.enableCache)return cache.push("pr:"+e+","+n+","+t+","+a,o),o}else logger.debug("区块索引未命中");return configAPI.data.common.enableCache&&cache.push("pr:"+e+","+n+","+t+","+a,"em"),null}function getOLandIdbyPos(e,n,t,a){if(configAPI.data.common.enableCache){var i=cache.try("og:"+e+","+n+","+t+","+a);if("em"===i)return logger.debug("缓存命中:空"),null;if(i)return logger.debug("缓存命中:"+i),i;logger.debug("缓存未命中，查区块索引试试")}for(const o of ChunkInterface.getChunksLand(e,t,a,!0))if(OlandDataInterface.isPosInLand(e,n,t,a,o)&&(logger.debug("区块索引命中："+o),configAPI.data.common.enableCache))return cache.push("og:"+e+","+n+","+t+","+a,o),o;return configAPI.data.common.enableCache&&cache.push("og:"+e+","+n+","+t+","+a,"em"),null}function twoPosFormat(e,n){return{minX:(e[0]>n[0]?n:e)[0],minY:(e[1]>n[1]?n:e)[1],minZ:(e[2]>n[2]?n:e)[2],maxX:(e[0]<n[0]?n:e)[0],maxY:(e[1]<n[1]?n:e)[1],maxZ:(e[2]<n[2]?n:e)[2],dx:Math.abs(e[0]-n[0]),dy:Math.abs(e[1]-n[1]),dz:Math.abs(e[2]-n[2])}}function getPLandConflict(t,a,i=!1,o=[]){var r={minX:Math.floor(t.minX/16-1),minZ:Math.floor(t.minZ/16-1),maxX:Math.floor(t.maxX/16+1),maxZ:Math.floor(t.maxZ/16+1)};for(let n=r.minX;n<r.maxX;n++)for(let e=r.minZ;e<r.maxZ;e++)for(const s of ChunkInterface.getChunks(n,e,a))if(-1===o.indexOf(s)){if(pLandDataInterface.isRangeInLand(t,a,i,s))return logger.debug("冲突："+s),s;o.push(s),logger.debug("[没有冲突]")}return null}function getPLandinRange(t,a,i=!1){var o={minX:Math.floor(t.minX/16-1),minZ:Math.floor(t.minZ/16-1),maxX:Math.floor(t.maxX/16+1),maxZ:Math.floor(t.maxZ/16+1)};let r=[],s=[];for(let n=o.minX;n<o.maxX;n++)for(let e=o.minZ;e<o.maxZ;e++)for(const l of ChunkInterface.getChunks(n,e,a,!1))-1===r.indexOf(l)&&-1===s.indexOf(l)&&(pLandDataInterface.isRangeInLand(t,a,i,l)?(logger.debug("在内部："+l),s.push(l)):(r.push(l),logger.debug("在外部："+l)));return s}function getOLandConflict(t,a,i=!1,o=[],r,s=!1){var l={minX:Math.floor(t.minX/16-1),minZ:Math.floor(t.minZ/16-1),maxX:Math.floor(t.maxX/16+1),maxZ:Math.floor(t.maxZ/16+1)};for(let n=l.minX;n<l.maxX;n++)for(let e=l.minZ;e<l.maxZ;e++)for(const m of ChunkInterface.getChunks(n,e,a,!0))if(-1===o.indexOf(m))if(OlandDataInterface.isRangeInLand(t,a,i,m)){if(s)return logger.debug("[有冲突]"),m;var d=OlandDataInterface.data[m];if(d.permissions.organization.allowOtherEnclose)logger.debug("[有冲突]但此领地允许任何人圈地"),o.push(m);else if(d.permissions.organization.allowMemberEnclose&&d.settings.owner===orgAPI.getOrgNum(r.xuid))logger.debug("[有冲突]但此领地允许玩家圈地且玩家是本公会的人"),o.push(m);else{if(!orgAPI.isOwner(r.xuid))return logger.debug("[有冲突]"),m;logger.debug("[有冲突]但此玩家是领地所属公会的管理员"),o.push(m)}}else o.push(m),logger.debug("[没有冲突]");return null}let playerState={};const drawCube=lxl.import("xmmppsjs_drawCube");function CommandEncloseHander(a,n){var t=a.blockPos;switch(n){case"setpos1":if("reEnclosing"!==playerState[a.xuid].state&&(playerState[a.xuid].state="enclosing"),t.dimid!==playerState[a.xuid].enclosure.dim){if("reEnclosing"===playerState[a.xuid].state)return void a.tell(i18n.$t("reEnclosing.dimnoChange"));playerState[a.xuid].enclosure.dim=t.dimid,playerState[a.xuid].enclosure.posA=[t.x,t.y,t.z],playerState[a.xuid].enclosure.posB=[]}else playerState[a.xuid].enclosure.posA=[t.x,t.y,t.z],0!==playerState[a.xuid].enclosure.posA.length&&0!==playerState[a.xuid].enclosure.posB.length&&enableDrawLine&&(i=twoPosFormat(playerState[a.xuid].enclosure.posA,playerState[a.xuid].enclosure.posB),drawCube(i.minX,i.minY,i.minZ,i.dx+1,i.dy+1,i.dz+1,playerState[a.xuid].enclosure.dim,"f",.04,!0));break;case"setpos2":if("reEnclosing"!==playerState[a.xuid].state&&(playerState[a.xuid].state="enclosing"),t.dimid!==playerState[a.xuid].enclosure.dim){if("reEnclosing"===playerState[a.xuid].state)return void a.tell(i18n.$t("reEnclosing.dimnoChange"));playerState[a.xuid].enclosure.dim=t.dimid,playerState[a.xuid].enclosure.posB=[t.x,t.y,t.z],playerState[a.xuid].enclosure.posA=[]}else playerState[a.xuid].enclosure.posB=[t.x,t.y,t.z],0!==playerState[a.xuid].enclosure.posA.length&&0!==playerState[a.xuid].enclosure.posB.length&&enableDrawLine&&(i=twoPosFormat(playerState[a.xuid].enclosure.posA,playerState[a.xuid].enclosure.posB),drawCube(i.minX,i.minY,i.minZ,i.dx+1,i.dy+1,i.dz+1,playerState[a.xuid].enclosure.dim,"f",.04,!0));break;case"cancel":playerState[a.xuid].state="playing","reEnclosing"===playerState[a.xuid].state&&(playerState[a.xuid].editingLand.landId="");break;case"show":playerState[a.xuid].state="enclosing",0!==playerState[a.xuid].enclosure.posA.length&&0!==playerState[a.xuid].enclosure.posB.length&&enableDrawLine&&(i=twoPosFormat(playerState[a.xuid].enclosure.posA,playerState[a.xuid].enclosure.posB),drawCube(i.minX,i.minY,i.minZ,i.dx+1,i.dy+1,i.dz+1,playerState[a.xuid].enclosure.dim,"f",.04,!0));break;case"edit":if(0===playerState[a.xuid].enclosure.posA.length||0===playerState[a.xuid].enclosure.posB.length)return void a.tell(i18n.$t("enclose.edit.noHavePos"));let e=mc.newCustomForm().setTitle(i18n.$t("enclose.edit.formTitle"));return e.addLabel(i18n.$t("enclose.edit.label")),e.addInput(i18n.$t("enclose.edit.posA")+"X",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posA[0])),e.addInput(i18n.$t("enclose.edit.posA")+"Y",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posA[1])),e.addInput(i18n.$t("enclose.edit.posA")+"Z",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posA[2])),e.addInput(i18n.$t("enclose.edit.posB")+"X",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posB[0])),e.addInput(i18n.$t("enclose.edit.posB")+"Y",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posB[1])),e.addInput(i18n.$t("enclose.edit.posB")+"Z",i18n.$t("enclose.edit.posDesp"),String(playerState[a.xuid].enclosure.posB[2])),void a.sendForm(e,(e,n)=>{var t;null!=n&&(t=e.xuid,319<parseInt(n[2])||parseInt(n[2])<-64||319<parseInt(n[5])||parseInt(n[5])<-64?e.tell(i18n.$t("enclose.edit.errorY")):(playerState[t].enclosure.posA[0]=parseInt(n[1]),playerState[t].enclosure.posA[1]=parseInt(n[2]),playerState[t].enclosure.posA[2]=parseInt(n[3]),playerState[t].enclosure.posB[0]=parseInt(n[4]),playerState[t].enclosure.posB[1]=parseInt(n[5]),playerState[t].enclosure.posB[2]=parseInt(n[6]),e.tell(i18n.$t("enclose.edit.success")),0!==playerState[a.xuid].enclosure.posA.length&&0!==playerState[a.xuid].enclosure.posB.length&&enableDrawLine&&(t=twoPosFormat(playerState[a.xuid].enclosure.posA,playerState[a.xuid].enclosure.posB),drawCube(t.minX,t.minY,t.minZ,t.dx+1,t.dy+1,t.dz+1,playerState[a.xuid].enclosure.dim,"f",.04,!0))))});case"confirm":if("enclosing"===playerState[a.xuid].state||"reEnclosing"===playerState[a.xuid].state){if(0===playerState[a.xuid].enclosure.posA.length||0===playerState[a.xuid].enclosure.posB.length)return void a.tell(i18n.$t("enclose.confirm.noHavePos"));var i=playerState[a.xuid].enclosure.dim,o=playerState[a.xuid].enclosure.posA.length?String(playerState[a.xuid].enclosure.posA):i18n.$t("enclose.edit,nochoose"),r=playerState[a.xuid].enclosure.posB.length?String(playerState[a.xuid].enclosure.posB):i18n.$t("enclose.edit,nochoose");(configAPI.data.common.allow2D||configAPI.data.common.allow3D)&&(configAPI.data.common.allow3D?configAPI.data.common.allow2D||(playerState[a.xuid].enclosure.type2D=!1,("enclosing"===playerState[a.xuid].state?SelectEncloseType:ReEnclosingScan)(pl)):(playerState[a.xuid].enclosure.type2D=!0,("enclosing"===playerState[a.xuid].state?SelectEncloseType:ReEnclosingScan)(pl))),a.sendModalForm(i18n.$t("enclose.confirm.title"),i18n.$t("enclose.confirm.info",[o,r,i]),"2D","3D",function(e,n){null!=n&&(playerState[a.xuid].enclosure.type2D=!!n,("enclosing"===playerState[a.xuid].state?SelectEncloseType:ReEnclosingScan)(e))})}else a.tell(i18n.$t("enclose.edit.noEnclosing"))}}function SelectEncloseType(e){let t=twoPosFormat(playerState[e.xuid].enclosure.posA,playerState[e.xuid].enclosure.posB);if(319<t.maxY&&(t.maxY=319),t.minY<-64&&(t.minY=-64),playerState[e.xuid].enclosure.type2D&&(t.minY=-64,t.maxY=319),t.dy=t.maxY-t.minY,configAPI.data.limit.allowDimension.includes(playerState[e.xuid].enclosure.dim)||configAPI.data.operator.includes(e.xuid)||e.tell(i18n.$t("enclose.confirm.dimensionNotAllow")),playerState[e.xuid].enclosure.type2D){var n=t.dx*t.dz;if(n>configAPI.data.limit.type2DSquare[1]||n<configAPI.data.limit.type2DSquare[0])return n=mc.newSimpleForm().setTitle(i18n.$t("enclose.confirm.over")).setContent(i18n.$t("enclose.confirm.2D.over",[n,configAPI.data.limit.type2DSquare[1],configAPI.data.limit.type2DSquare[0]])),void e.sendForm(n,()=>{})}else{var n=t.dx*t.dz*t.dz;if(n>configAPI.data.limit.type3DVolume[1]||n<configAPI.data.limit.type3DVolume[0])return n=mc.newSimpleForm().setTitle(i18n.$t("enclose.confirm.over")).setContent(i18n.$t("enclose.confirm.3D.over",[n,configAPI.data.limit.type3DVolume[1],configAPI.data.limit.type3DVolume[0]])),void e.sendForm(n,()=>{})}enableOrg&&orgAPI.isOwner(e.xuid)?e.sendModalForm(i18n.$t("enclose.chooseType.title"),i18n.$t("enclose.chooseType.desp"),i18n.$t("enclose.chooseType.priButton"),i18n.$t("enclose.chooseType.orgButton"),(e,n)=>{null!=n&&(n?enclosePayment(e,t):enclosePayment(e,t,orgAPI.getOrgNum(e.xuid)))}):enclosePayment(e,t)}function enclosePayment(t,a,i=null){let e;var n;if(enableOrg&&(e=getOLandConflict(a,playerState[t.xuid].enclosure.dim,playerState[t.xuid].enclosure.type2D,[],t,!!i)))return n=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.org",[e])),void t.sendForm(n,()=>{});if(e=getPLandConflict(a,playerState[t.xuid].enclosure.dim,playerState[t.xuid].enclosure.type2D))return n=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.pri",[e])),void t.sendForm(n,()=>{});let o=0;o=playerState[t.xuid].enclosure.type2D?a.dx*a.dz*configAPI.data.sell.type2D.priceSquare:configAPI.data.sell.type3D.priceY?a.dx*a.dz*configAPI.data.sell.type3D.priceXZ+a.dy*configAPI.data.sell.type3D.priceY:a.dx*a.dy*posInterfaces.dz*configAPI.data.sell.type3D.priceXZ,i?moneyUni.get(t)<o&&orgAPI.orgGetMoney(i)<o?(n=mc.newSimpleForm().setTitle(i18n.$t("enclose.payment.title")).setContent(i18n.$t("enclose.payment.moneyNoEnough",[configAPI.data.economy.moneyName,o,moneyUni.get(t)])),t.sendForm(n,()=>{})):moneyUni.get(t)<o?t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.ori",[o,orgAPI.orgGetMoney(i)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{null!=n&&n&&(orgAPI.orgAddMoney(i,-o)?encloseMain(e,a,i):t.tell(i18n.$t("enclose.payment.error")))}):orgAPI.orgGetMoney(orgAPI.getOrgNum(t.xuid))<o?t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.pri",[o,moneyUni.get(t)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{null!=n&&n&&(moneyUni.pay(t,o)?encloseMain(e,a,i):t.tell(i18n.$t("enclose.payment.error")))}):t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.choose",[o,moneyUni.get(t),orgAPI.orgGetMoney(i)]),i18n.$t("enclose.pay.self"),i18n.$t("enclose.pay.org"),(e,n)=>{null!=n&&(n?moneyUni.pay(t,o)?encloseMain(e,a,i):t.tell(i18n.$t("enclose.payment.error")):orgAPI.orgAddMoney(i,-o)?encloseMain(e,a,i):t.tell(i18n.$t("enclose.payment.error")))}):moneyUni.get(t)<o?(n=mc.newSimpleForm().setTitle(i18n.$t("enclose.payment.title")).setContent(i18n.$t("enclose.payment.moneyNoEnough",[configAPI.data.economy.moneyName,o,moneyUni.get(t)])),t.sendForm(n,()=>{})):t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.pri",[o,moneyUni.get(t)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{null!=n&&n&&(moneyUni.pay(t,o)?encloseMain(e,a):t.tell(i18n.$t("enclose.payment.error")))})}function encloseMain(e,n,t=null){let a;if(enableOrg&&(a=getOLandConflict(n,playerState[e.xuid].enclosure.dim,playerState[e.xuid].enclosure.type2D,[],e,!!t)))return i=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.org",[a])),void e.sendForm(i,()=>{});if(a=getPLandConflict(n,playerState[e.xuid].enclosure.dim,playerState[e.xuid].enclosure.type2D))return i=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.pri",[a])),void e.sendForm(i,()=>{});var i=system.randomGuid(),t=(t?(OlandDataInterface.data[i]={range:{type2D:playerState[e.xuid].enclosure.type2D,min_position:[n.minX,n.minY,n.minZ],dimid:playerState[e.xuid].enclosure.dim,max_position:[n.maxX,n.maxY,n.maxZ]},settings:{notifyItemBar:!0,notifytoPlayer:!0,notifytoOwner:!0,drawCube:!0,describe:"",owner:t,name:i18n.$t("default.landName",[e.realName])},teleport:[],events:{pistonPush:!1,fireSpread:!1,explode:!1,redstoneUpdate:!1,farmlandDecay:!1,liquidFlow:!0,blockChange:!0},permissions:{organization:{allowOtherEnclose:!1,allowMemberEnclose:!1,trustMembers:!0},blocks:{blockPlace:!1,itemPickUp:!1,blockDestory:!1,itemDrop:!0,openDoor:!1,useFenceGate:!1,useTrapdoor:!1},entity:{allowRideEntity:!1,allowEntityDestroy:!1,allowUseBoat:!0,allowUseMinecart:!0,allowShoot:!1,allowAttackEntity:!1},container:{openShulkerBox:!1,useFrameBlock:!1,openChest:!1,openBarrel:!1,openHopper:!1},redStone:{pressButton:!1,useLever:!1,usePressurePlate:!1,useDispenser:!1,useDropper:!1,useDaylightDetector:!1,changeComparator:!1,changeRepeater:!1,HopperChange:!1,pistonPush:!1},tools:{useBell:!1,useLoom:!1,useJukebox:!1,useBeacon:!1,useCraftingTable:!1,useCartographyTable:!1,useAnvil:!1,useBucket:!1,useBed:!1,useBlastFurnace:!1,useComposter:!1,useFurnace:!1,useGrindstone:!1,useRespawnAnchor:!1,useSmithingTable:!1,useNoteBlock:!1,useArmorStand:!1,useLectern:!1,useCampfire:!1,useSmoker:!1,useBrewingStand:!1,useEnchantingTable:!1,useFlint:!1,useCauldron:!1,useStonecutter:!1},player:{eat:!1,fishing:!1,allowThrowPotion:!1,allowUseBoat:!0,allowUseMinecart:!0,allowShoot:!1,allowAttackAnimal:!1,allowAttackNeutral:!1,allowAttackPlayer:!1,allowAttackMobs:!0}}},ChunkInterface.linkOrg(i),belongToApi.orgAddLand(t,i),belongToApi.save(),OlandDataInterface.save()):(pLandDataInterface.data[i]={range:{type2D:playerState[e.xuid].enclosure.type2D,min_position:[n.minX,n.minY,n.minZ],dimid:playerState[e.xuid].enclosure.dim,max_position:[n.maxX,n.maxY,n.maxZ]},settings:{notifyItemBar:!0,notifytoPlayer:!0,notifytoOwner:!0,drawCube:!0,describe:"",owner:e.xuid,name:i18n.$t("default.landName",[e.realName])},share:[],teleport:[],events:{pistonPush:!1,fireSpread:!1,explode:!1,redstoneUpdate:!1,farmlandDecay:!1,liquidFlow:!0,blockChange:!0},permissions:{blocks:{blockPlace:!1,itemPickUp:!1,blockDestory:!1,itemDrop:!0,openDoor:!1,useFenceGate:!1,useTrapdoor:!1},entity:{allowRideEntity:!1,allowEntityDestroy:!1,allowUseBoat:!0,allowUseMinecart:!0,allowShoot:!1,allowAttackEntity:!1},container:{openShulkerBox:!1,useFrameBlock:!1,openChest:!1,openBarrel:!1,openHopper:!1},redStone:{pressButton:!1,useLever:!1,usePressurePlate:!1,useDispenser:!1,useDropper:!1,useDaylightDetector:!1,changeComparator:!1,changeRepeater:!1,HopperChange:!1,pistonPush:!1},tools:{useBell:!1,useLoom:!1,useJukebox:!1,useBeacon:!1,useCraftingTable:!1,useCartographyTable:!1,useAnvil:!1,useBucket:!1,useBed:!1,useBlastFurnace:!1,useComposter:!1,useFurnace:!1,useGrindstone:!1,useRespawnAnchor:!1,useSmithingTable:!1,useNoteBlock:!1,useArmorStand:!1,useLectern:!1,useCampfire:!1,useSmoker:!1,useBrewingStand:!1,useEnchantingTable:!1,useFlint:!1,useCauldron:!1,useStonecutter:!1},player:{eat:!1,fishing:!1,allowThrowPotion:!1,allowUseBoat:!0,allowUseMinecart:!0,allowShoot:!1,allowAttackAnimal:!1,allowAttackNeutral:!1,allowAttackPlayer:!1,allowAttackMobs:!0}}},ChunkInterface.linkPrivate(i),belongToApi.playerAddLand(e,i),belongToApi.save(),pLandDataInterface.save()),configAPI.data.common.enableCache&&(ChunkInterface.save(),cache.clean()),playerState[e.xuid].state="playing",mc.newSimpleForm().setTitle(i18n.$t("enclose.payment.title")).setContent(i18n.$t("enclose.payment.success")));e.sendForm(t,()=>{})}function CommandThisHander(t){var e=t.blockPos;let a=getPLandIdbyPos(e.x,e.y,e.z,e.dimid),i=getOLandIdbyPos(e.x,e.y,e.z,e.dimid),n=[0,0];configAPI.data.operator.includes(t.xuid)&&(n=[!!a,!!i]),a&&pLandDataInterface.data[a].settings.owner===t.xuid&&(n[0]=!0),i&&OlandDataInterface.data[i].settings.owner===orgAPI.getOrgNum(t.xuid)&&orgAPI.isOwner(t.xuid)&&(n[1]=!0),n[0]&&n[1]?t.sendModalForm(i18n.$t("this.manage.choose.title"),i18n.$t("this.manage.choose.desp"),i18n.$t("this.manage.choose.org"),i18n.$t("this.manage.choose.pri"),(e,n)=>{null!=n&&(n?ManageLand(t,i,!0):ManageLand(t,a,!1))}):n[0]?ManageLand(t,a,!1):n[1]?ManageLand(t,i,!0):t.tell(i18n.$t("this.manage.noland"))}function ManageLand(e,t,a=!1){let n=mc.newSimpleForm();n.setTitle(i18n.$t("manage.main.title")),n.addButton(i18n.$t("manage.main.info"),"textures/items/book_enchanted"),n.addButton(i18n.$t("manage.main.identification"),"textures/items/name_tag"),n.addButton(i18n.$t("manage.main.events"),"textures/items/hopper"),n.addButton(i18n.$t("manage.main.teleport"),"textures/items/ender_eye"),n.addButton(i18n.$t("manage.main.permission"),"textures/items/diamond_sword"),n.addButton(i18n.$t("manage.main.recycle"),"textures/items/totem"),n.addButton(i18n.$t("manage.main.reenclose"),"textures/items/map_empty"),a||(n.addButton(i18n.$t("manage.main.resell"),"textures/items/villagebell"),n.addButton(i18n.$t("manage.main.share"),"textures/items/apple"),n.addButton(i18n.$t("manage.main.changeOwner"),"textures/items/armor_stand")),e.sendForm(n,(e,n)=>{if(null!=n)switch(n){case 0:LandInfo(e,t,a);break;case 1:LandIdentification(e,t,a);break;case 2:LandEventsManage(e,t,a);break;case 3:LnadTeleportManage(e,t,a);break;case 4:PermissionManageEntry(e,t,a);break;case 5:recycleLand(e,t,a);break;case 6:reEnclosingHander(e,t,a);break;case 7:landResellManager(e,t,a);break;case 8:sharedManageHander(e,t,a);break;case 9:changeOwnerHander(e,t,a)}})}function LandInfo(e,t,a=!1){let n,i=(n=(a?OlandDataInterface:pLandDataInterface).data[t],mc.newSimpleForm());i.setTitle(i18n.$t("manage.info.title")),i.setContent(i18n.$t("manage.info.desp",[t,String(n.range.min_position),String(n.range.max_position),n.range.dimid,a?i18n.$t("this.manage.choose.org"):i18n.$t("this.manage.choose.pri"),a?orgAPI.getOrgName(n.settings.owner)||i18n.$t("manage.info.noOrg"):data.xuid2name(n.settings.owner),n.settings.describe||i18n.$t("manage.info.noDesp"),n.range.type2D?i18n.$t("common.YES"):i18n.$t("common.NO"),0===n.teleport.length?i18n.$t("manage.info.noDesp"):String(n.teleport)])),e.sendForm(i,(e,n)=>{null==n&&ManageLand(e,t,a)})}function LandIdentification(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.idf.title")),e.addInput(i18n.$t("manage.idf.name"),"...",o.settings.name),e.addInput(i18n.$t("manage.idf.describe"),"...",o.settings.describe),e.addSwitch(i18n.$t("manage.idf.notifyItemBar"),!!o.settings.notifyItemBar),e.addSwitch(i18n.$t("manage.idf.notifytoPlayer"),!!o.settings.notifytoPlayer),e.addSwitch(i18n.$t("manage.idf.notifytoOwner"),!!o.settings.notifytoOwner),e.addSwitch(i18n.$t("manage.idf.drawCube"),!!o.settings.drawCube),t.sendForm(e,(e,n)=>{if(null==n)ManageLand(e,a,i);else{if(""===n[0])return e=mc.newSimpleForm().setTitle(i18n.$t("manage.idf.title")).setContent(i18n.$t("manage.idf.NamenoEmpty")),void t.sendForm(e,(e,n)=>{LandIdentification(e,a,i)});o.settings.name=n[0],o.settings.describe=n[1],o.settings.notifyItemBar=!!n[2],o.settings.notifytoPlayer=!!n[3],o.settings.notifytoOwner=!!n[4],o.settings.drawCube=!!n[5],i?(OlandDataInterface.data[a].settings=o.settings,OlandDataInterface.save()):(pLandDataInterface.data[a].settings=o.settings,pLandDataInterface.save());e=mc.newSimpleForm().setTitle(i18n.$t("manage.idf.title")).setContent(i18n.$t("manage.idf.success"));t.sendForm(e,(e,n)=>{ManageLand(e,a,i)})}})}function LandEventsManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.event.title")),e.addSwitch(i18n.$t("manage.event.pistonPush"),!!o.events.pistonPush),e.addSwitch(i18n.$t("manage.event.fireSpread"),!!o.events.fireSpread),e.addSwitch(i18n.$t("manage.event.explode"),!!o.events.explode),e.addSwitch(i18n.$t("manage.event.redstoneUpdate"),!!o.events.redstoneUpdate),e.addSwitch(i18n.$t("manage.event.farmlandDecay"),!!o.events.farmlandDecay),e.addSwitch(i18n.$t("manage.event.liquidFlow"),!!o.events.liquidFlow),e.addSwitch(i18n.$t("manage.event.blockChange"),!!o.events.blockChange),t.sendForm(e,(e,n)=>{null==n?ManageLand(e,a,i):(o.events.pistonPush=!!n[0],o.events.fireSpread=!!n[1],o.events.explode=!!n[2],o.events.redstoneUpdate=!!n[3],o.events.farmlandDecay=!!n[4],o.events.liquidFlow=!!n[5],o.events.blockChange=!!n[6],i?(OlandDataInterface.data[a].events=o.events,OlandDataInterface.save()):(pLandDataInterface.data[a].events=o.events,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.event.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{ManageLand(e,a,i)}))})}function LnadTeleportManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newSimpleForm());var n=configAPI.data.operator.includes(t.xuid)||configAPI.data.common.allowLandTeleport;e.setTitle(i18n.$t("manage.teleport.title")),e.setContent(n?i18n.$t("manage.teleport.desp",[String(o.teleport)]):i18n.$t("manage.teleport.noEnable")),n&&0===o.teleport.length?e.addButton(i18n.$t("manage.teleport.set"),"textures/items/chorus_fruit"):n&&e.addButton(i18n.$t("manage.teleport.clear"),"textures/items/chorus_fruit"),t.sendForm(e,(e,n)=>{if(null==n)ManageLand(e,a,i);else if(0===n)if(0!==o.teleport.length){i?(OlandDataInterface.data[a].teleport=[],OlandDataInterface.save()):(pLandDataInterface.data[a].teleport=[],pLandDataInterface.save());e=mc.newSimpleForm().setTitle(i18n.$t("manage.teleport.title")).setContent(i18n.$t("manage.teleport.clearSuccess"));t.sendForm(e,(e,n)=>{LnadTeleportManage(e,a,i)})}else{n=t.blockPos;if(i&&!OlandDataInterface.isPosInLand(n.x,n.y,n.z,n.dimid,a)||!i&&!pLandDataInterface.isPosInLand(n.x,n.y,n.z,n.dimid,a))return e=mc.newSimpleForm().setTitle(i18n.$t("manage.teleport.title")).setContent(i18n.$t("manage.teleport.clearSuccess")),void t.sendForm(e,(e,n)=>{LnadTeleportManage(e,a,i)});i?(OlandDataInterface.data[a].teleport=[n.x,n.y,n.z],OlandDataInterface.save()):(pLandDataInterface.data[a].teleport=[n.x,n.y,n.z],pLandDataInterface.save());e=mc.newSimpleForm().setTitle(i18n.$t("manage.teleport.title")).setContent(i18n.$t("manage.idf.success"));t.sendForm(e,(e,n)=>{LnadTeleportManage(e,a,i)})}})}function PermissionManageEntry(e,t,a=!1){let n,i=(n=(a?OlandDataInterface:pLandDataInterface).data[t],mc.newSimpleForm());i.setTitle(i18n.$t("manage.permission.main.title")),i.addButton(i18n.$t("manage.permission.main.blocks"),"textures/ui/icon_recipe_nature"),i.addButton(i18n.$t("manage.permission.main.entity"),"textures/ui/icon_deals"),i.addButton(i18n.$t("manage.permission.main.container"),"textures/ui/inventory_icon"),i.addButton(i18n.$t("manage.permission.main.redStone"),"textures/items/redstone_dust"),i.addButton(i18n.$t("manage.permission.main.tools"),"textures/ui/icon_recipe_equipment"),i.addButton(i18n.$t("manage.permission.main.player"),"textures/ui/icon_armor"),a&&i.addButton(i18n.$t("manage.permission.main.organization"),"textures/ui/lan_icon"),e.sendForm(i,(e,n)=>{if(null==n)ManageLand(e,t,a);else switch(n){case 0:BlockPermissionManage(e,t,a);break;case 1:EntityPermissionManage(e,t,a);break;case 2:ContainerPermissionManage(e,t,a);break;case 3:RedstonePermissionManage(e,t,a);break;case 4:ToolsPermissionManage(e,t,a);break;case 5:PlayerPermissionManage(e,t,a);break;case 6:OrgPermissionManage(e,t,a)}})}function BlockPermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.blocks.title")),e.addSwitch(i18n.$t("manage.permission.blocks.blockPlace"),!!o.permissions.blocks.blockPlace),e.addSwitch(i18n.$t("manage.permission.blocks.blockDestory"),!!o.permissions.blocks.blockDestory),e.addSwitch(i18n.$t("manage.permission.blocks.itemDrop"),!!o.permissions.blocks.itemDrop),e.addSwitch(i18n.$t("manage.permission.blocks.itemPickUp"),!!o.permissions.blocks.itemPickUp),e.addSwitch(i18n.$t("manage.permission.blocks.openDoor"),!!o.permissions.blocks.openDoor),e.addSwitch(i18n.$t("manage.permission.blocks.useFenceGate"),!!o.permissions.blocks.useFenceGate),e.addSwitch(i18n.$t("manage.permission.blocks.useTrapdoor"),!!o.permissions.blocks.useTrapdoor),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.blocks.blockPlace=n[0],o.permissions.blocks.blockDestory=n[1],o.permissions.blocks.itemDrop=n[2],o.permissions.blocks.itemPickUp=n[3],o.permissions.blocks.openDoor=n[4],o.permissions.blocks.useFenceGate=n[5],o.permissions.blocks.useTrapdoor=n[6],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.blocks.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function EntityPermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.entity.title")),e.addSwitch(i18n.$t("manage.permission.entity.allowRideEntity"),!!o.permissions.entity.allowRideEntity),e.addSwitch(i18n.$t("manage.permission.entity.allowUseBoat"),!!o.permissions.entity.allowUseBoat),e.addSwitch(i18n.$t("manage.permission.entity.allowUseMinecart"),!!o.permissions.entity.allowUseMinecart),e.addSwitch(i18n.$t("manage.permission.entity.allowShoot"),!!o.permissions.entity.allowShoot),e.addSwitch(i18n.$t("manage.permission.entity.allowAttackEntity"),!!o.permissions.entity.allowAttackEntity),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.entity.allowRideEntity=n[0],o.permissions.entity.allowUseBoat=n[1],o.permissions.entity.allowUseMinecart=n[2],o.permissions.entity.allowShoot=n[3],o.permissions.entity.allowAttackEntity=n[4],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.blocks.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function ContainerPermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.container.title")),e.addSwitch(i18n.$t("manage.permission.container.useFrameBlock"),!!o.permissions.container.useFrameBlock),e.addSwitch(i18n.$t("manage.permission.container.openShulkerBox"),!!o.permissions.container.openShulkerBox),e.addSwitch(i18n.$t("manage.permission.container.openChest"),!!o.permissions.container.openChest),e.addSwitch(i18n.$t("manage.permission.container.openBarrel"),!!o.permissions.container.openBarrel),e.addSwitch(i18n.$t("manage.permission.container.openHopper"),!!o.permissions.container.openHopper),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.container.useFrameBlock=n[0],o.permissions.container.openShulkerBox=n[1],o.permissions.container.openChest=n[2],o.permissions.container.openBarrel=n[3],o.permissions.container.openHopper=n[4],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.container.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function RedstonePermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.redStone.title")),e.addSwitch(i18n.$t("manage.permission.redStone.pressButton"),!!o.permissions.redStone.pressButton),e.addSwitch(i18n.$t("manage.permission.redStone.useLever"),!!o.permissions.redStone.useLever),e.addSwitch(i18n.$t("manage.permission.redStone.useDispenser"),!!o.permissions.redStone.useDispenser),e.addSwitch(i18n.$t("manage.permission.redStone.useDropper"),!!o.permissions.redStone.useDropper),e.addSwitch(i18n.$t("manage.permission.redStone.usePressurePlate"),!!o.permissions.redStone.usePressurePlate),e.addSwitch(i18n.$t("manage.permission.redStone.useDaylightDetector"),!!o.permissions.redStone.useDaylightDetector),e.addSwitch(i18n.$t("manage.permission.redStone.changeComparator"),!!o.permissions.redStone.changeComparator),e.addSwitch(i18n.$t("manage.permission.redStone.changeRepeater"),!!o.permissions.redStone.changeRepeater),e.addSwitch(i18n.$t("manage.permission.redStone.HopperChange"),!!o.permissions.redStone.HopperChange),e.addSwitch(i18n.$t("manage.permission.redStone.pistonPush"),!!o.permissions.redStone.pistonPush),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.redStone.pressButton=n[0],o.permissions.redStone.useLever=n[1],o.permissions.redStone.useDispenser=n[2],o.permissions.redStone.useDropper=n[3],o.permissions.redStone.usePressurePlate=n[4],o.permissions.redStone.useDaylightDetector=n[5],o.permissions.redStone.changeComparator=n[6],o.permissions.redStone.changeRepeater=n[7],o.permissions.redStone.HopperChange=n[8],o.permissions.redStone.pistonPush=n[9],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.redStone.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function ToolsPermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.tools.title")),e.addSwitch(i18n.$t("manage.permission.tools.useBell"),!!o.permissions.tools.useBell),e.addSwitch(i18n.$t("manage.permission.tools.useLoom"),!!o.permissions.tools.useLoom),e.addSwitch(i18n.$t("manage.permission.tools.useJukebox"),!!o.permissions.tools.useJukebox),e.addSwitch(i18n.$t("manage.permission.tools.useBeacon"),!!o.permissions.tools.useBeacon),e.addSwitch(i18n.$t("manage.permission.tools.useCraftingTable"),!!o.permissions.tools.useCraftingTable),e.addSwitch(i18n.$t("manage.permission.tools.useCartographyTable"),!!o.permissions.tools.useCartographyTable),e.addSwitch(i18n.$t("manage.permission.tools.useAnvil"),!!o.permissions.tools.useAnvil),e.addSwitch(i18n.$t("manage.permission.tools.useBucket"),!!o.permissions.tools.useBucket),e.addSwitch(i18n.$t("manage.permission.tools.useBed"),!!o.permissions.tools.useBed),e.addSwitch(i18n.$t("manage.permission.tools.useBlastFurnace"),!!o.permissions.tools.useBlastFurnace),e.addSwitch(i18n.$t("manage.permission.tools.useComposter"),!!o.permissions.tools.useComposter),e.addSwitch(i18n.$t("manage.permission.tools.useFurnace"),!!o.permissions.tools.useFurnace),e.addSwitch(i18n.$t("manage.permission.tools.useGrindstone"),!!o.permissions.tools.useGrindstone),e.addSwitch(i18n.$t("manage.permission.tools.useRespawnAnchor"),!!o.permissions.tools.useRespawnAnchor),e.addSwitch(i18n.$t("manage.permission.tools.useSmithingTable"),!!o.permissions.tools.useSmithingTable),e.addSwitch(i18n.$t("manage.permission.tools.useNoteBlock"),!!o.permissions.tools.useNoteBlock),e.addSwitch(i18n.$t("manage.permission.tools.useArmorStand"),!!o.permissions.tools.useArmorStand),e.addSwitch(i18n.$t("manage.permission.tools.useLectern"),!!o.permissions.tools.useLectern),e.addSwitch(i18n.$t("manage.permission.tools.useCampfire"),!!o.permissions.tools.useCampfire),e.addSwitch(i18n.$t("manage.permission.tools.useSmoker"),!!o.permissions.tools.useSmoker),e.addSwitch(i18n.$t("manage.permission.tools.useBrewingStand"),!!o.permissions.tools.useBrewingStand),e.addSwitch(i18n.$t("manage.permission.tools.useEnchantingTable"),!!o.permissions.tools.useEnchantingTable),e.addSwitch(i18n.$t("manage.permission.tools.useFlint"),!!o.permissions.tools.useFlint),e.addSwitch(i18n.$t("manage.permission.tools.useCauldron"),!!o.permissions.tools.useCauldron),e.addSwitch(i18n.$t("manage.permission.tools.useStonecutter"),!!o.permissions.tools.useStonecutter),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.tools.useBell=n[0],o.permissions.tools.useLoom=n[1],o.permissions.tools.useJukebox=n[2],o.permissions.tools.useBeacon=n[3],o.permissions.tools.useCraftingTable=n[4],o.permissions.tools.useCartographyTable=n[5],o.permissions.tools.useAnvil=n[6],o.permissions.tools.useBucket=n[7],o.permissions.tools.useBed=n[8],o.permissions.tools.useBlastFurnace=n[9],o.permissions.tools.useComposter=n[10],o.permissions.tools.useFurnace=n[11],o.permissions.tools.useGrindstone=n[12],o.permissions.tools.useRespawnAnchor=n[13],o.permissions.tools.useSmithingTable=n[14],o.permissions.tools.useNoteBlock=n[15],o.permissions.tools.useArmorStand=n[16],o.permissions.tools.useLectern=n[17],o.permissions.tools.useCampfire=n[18],o.permissions.tools.useSmoker=n[19],o.permissions.tools.useBrewingStand=n[20],o.permissions.tools.useEnchantingTable=n[21],o.permissions.tools.useFlint=n[22],o.permissions.tools.useCauldron=n[23],o.permissions.tools.useStonecutter=n[24],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.tools.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function PlayerPermissionManage(t,a,i=!1){let o,e=(o=(i?OlandDataInterface:pLandDataInterface).data[a],mc.newCustomForm());e.setTitle(i18n.$t("manage.permission.player.title")),e.addSwitch(i18n.$t("manage.permission.player.eat"),!!o.permissions.player.eat),e.addSwitch(i18n.$t("manage.permission.player.fishing"),!!o.permissions.player.fishing),e.addSwitch(i18n.$t("manage.permission.player.allowThrowPotion"),!!o.permissions.player.allowThrowPotion),e.addSwitch(i18n.$t("manage.permission.player.allowUseBoat"),!!o.permissions.player.allowUseBoat),e.addSwitch(i18n.$t("manage.permission.player.allowUseMinecart"),!!o.permissions.player.allowUseMinecart),e.addSwitch(i18n.$t("manage.permission.player.allowShoot"),!!o.permissions.player.allowShoot),e.addSwitch(i18n.$t("manage.permission.player.allowAttackAnimal"),!!o.permissions.player.allowAttackAnimal),e.addSwitch(i18n.$t("manage.permission.player.allowAttackNeutral"),!!o.permissions.player.allowAttackNeutral),e.addSwitch(i18n.$t("manage.permission.player.allowAttackPlayer"),!!o.permissions.player.allowAttackPlayer),e.addSwitch(i18n.$t("manage.permission.player.allowAttackMobs"),!!o.permissions.player.allowAttackMobs),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.player.eat=n[0],o.permissions.player.fishing=n[1],o.permissions.player.allowThrowPotion=n[2],o.permissions.player.allowUseBoat=n[3],o.permissions.player.allowUseMinecart=n[4],o.permissions.player.allowShoot=n[5],o.permissions.player.allowAttackAnimal=n[6],o.permissions.player.allowAttackNeutral=n[7],o.permissions.player.allowAttackPlayer=n[8],o.permissions.player.allowAttackMobs=n[9],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.player.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}function OrgPermissionManage(t,a,i=!1){let o=OlandDataInterface.data[a],e=mc.newCustomForm();e.setTitle(i18n.$t("manage.permission.organization.title")),e.addSwitch(i18n.$t("manage.permission.organization.allowOtherEnclose"),!!o.permissions.organization.allowOtherEnclose),e.addSwitch(i18n.$t("manage.permission.organization.allowMemberEnclose"),!!o.permissions.organization.allowMemberEnclose),e.addSwitch(i18n.$t("manage.permission.organization.trustMembers"),!!o.permissions.organization.trustMembers),t.sendForm(e,(e,n)=>{null==n?PermissionManageEntry(e,a,i):(o.permissions.organization.allowOtherEnclose=n[0],o.permissions.organization.allowMemberEnclose=n[1],o.permissions.organization.trustMembers=n[2],i?(OlandDataInterface.data[a].permissions=o.permissions,OlandDataInterface.save()):(pLandDataInterface.data[a].permissions=o.permissions,pLandDataInterface.save()),e=mc.newSimpleForm().setTitle(i18n.$t("manage.permission.organization.title")).setContent(i18n.$t("manage.idf.success")),t.sendForm(e,(e,n)=>{PermissionManageEntry(e,a,i)}))})}setInterval(()=>{for(const r of mc.getOnlinePlayers()){var n=r.blockPos;switch(playerState[r.xuid]||(playerState[r.xuid]={state:"playing",inPLand:"",inOLand:"",editingLand:{isOrg:!1,LandId:""},enclosure:{type2D:!1,dim:0,posA:[],posB:[]}}),playerState[r.xuid].state){case"enclosing":var t=playerState[r.xuid].enclosure.dim,a=playerState[r.xuid].enclosure.posA.length?String(playerState[r.xuid].enclosure.posA):i18n.$t("enclose.edit,nochoose"),i=playerState[r.xuid].enclosure.posB.length?String(playerState[r.xuid].enclosure.posB):i18n.$t("enclose.edit,nochoose");return void r.sendText(i18n.$t("alert.buttom.enclosing",[a,i,t]),5);case"reEnclosing":playerState[r.xuid].enclosure.dim;a=playerState[r.xuid].enclosure.posA.length?String(playerState[r.xuid].enclosure.posA):i18n.$t("enclose.edit,nochoose"),i=playerState[r.xuid].enclosure.posB.length?String(playerState[r.xuid].enclosure.posB):i18n.$t("enclose.edit,nochoose"),t=(playerState[r.xuid].editingLand.isOrg?OlandDataInterface:pLandDataInterface).data[playerState[r.xuid].editingLand.landId];return void r.sendText(i18n.$t("alert.buttom.reEnclosing",[t.settings.name,a,i]),5)}let e=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(e){if(e===playerState[r.xuid].inPLand)return;if("playing"!==playerState[r.xuid].state)return;playerState[r.xuid].inPLand=e;var o=pLandDataInterface.data[e];o.settings.notifyItemBar&&r.sendText(i18n.$t("alert.buttom.join",[o.settings.name]),5),enableDrawLine&&o.settings.drawCube&&drawCube(o.range.min_position[0],o.range.min_position[1],o.range.min_position[2],o.range.max_position[0]-o.range.min_position[0]+1,o.range.max_position[1]-o.range.min_position[1]+1,o.range.max_position[2]-o.range.min_position[2]+1,o.range.dimid,"c",.02,!0),("playing"===playerState[r.xuid].state&&o.settings.notifytoOwner&&r.xuid===o.settings.owner||"playing"===playerState[r.xuid].state&&o.settings.notifytoPlayer)&&r.sendText(i18n.$t("alert.text.owner",[data.xuid2name(o.settings.owner)]),0),o.resell&&r.sendText(i18n.$t("resell.notify",[o.resell]))}else""!==playerState[r.xuid].inPLand&&(o=pLandDataInterface.data[playerState[r.xuid].inPLand],"playing"===playerState[r.xuid].state&&o.settings.notifyItemBar&&r.sendText(i18n.$t("alert.buttom.leave",[o.settings.name]),5),enableDrawLine&&o.settings.drawCube&&drawCube(o.range.min_position[0],o.range.min_position[1],o.range.min_position[2],o.range.max_position[0]-o.range.min_position[0]+1,o.range.max_position[1]-o.range.min_position[1]+1,o.range.max_position[2]-o.range.min_position[2]+1,o.range.dimid,"e",.04,!0),playerState[r.xuid].inPLand="");if(enableOrg)if(e=getOLandIdbyPos(n.x,n.y,n.z,n.dimid)){if(e===playerState[r.xuid].inOLand)return;if("playing"!==playerState[r.xuid].state)return;playerState[r.xuid].inOLand=e;var n=OlandDataInterface.data[e];n.settings.notifyItemBar&&r.sendText(i18n.$t("alert.buttom.orgjoin",[n.settings.name]),5),enableDrawLine&&n.settings.drawCube&&drawCube(n.range.min_position[0],n.range.min_position[1],n.range.min_position[2],n.range.max_position[0]-n.range.min_position[0]+1,n.range.max_position[1]-n.range.min_position[1]+1,n.range.max_position[2]-n.range.min_position[2]+1,n.range.dimid,"c",.02,!0),("playing"===playerState[r.xuid].state&&n.settings.notifytoOwner&&orgAPI.getOrgNum(r.xuid)===n.settings.owner&&orgAPI.isOwner(r.xuid)||"playing"===playerState[r.xuid].state&&n.settings.notifytoPlayer)&&r.sendText(i18n.$t("alert.text.owner",[orgAPI.getOrgName(n.settings.owner)]),0)}else""!==playerState[r.xuid].inOLand&&(n=OlandDataInterface.data[playerState[r.xuid].inOLand],"playing"===playerState[r.xuid].state&&n.settings.notifyItemBar&&r.sendText(i18n.$t("alert.buttom.orgleave",[n.settings.name]),5),enableDrawLine&&n.settings.drawCube&&drawCube(n.range.min_position[0],n.range.min_position[1],n.range.min_position[2],n.range.max_position[0]-n.range.min_position[0]+1,n.range.max_position[1]-n.range.min_position[1]+1,n.range.max_position[2]-n.range.min_position[2]+1,n.range.dimid,"e",.04,!0),playerState[r.xuid].inOLand="")}},configAPI.data.common.tickRate),mc.listen("onJoin",function(e){playerState[e.xuid]||(playerState[e.xuid]={state:"playing",inPLand:"",inOLand:"",editingLand:{isOrg:!1,LandId:""},enclosure:{type2D:!1,dim:0,posA:[],posB:[]}}),moneyUni.offlineMoney.get(e.xuid)&&(moneyUni.addMoney(parseInt(moneyUni.offlineMoney.get(e.xuid))),moneyUni.offlineMoney.delete(e.xuid)),playerDB.data[e.xuid]=e.realName,playerDB.save()}),mc.listen("onLeft",function(e){playerState[e.xuid]&&delete playerState[e.xuid]}),mc.listen("onServerStarted",function(){let e=mc.newCommand("land",i18n.$t("command.description"),PermType.Any,128);e.setEnum("encloseEnterance",["enclose"]),e.setEnum("encloseAction",["setpos1","setpos2","confirm","cancel","show","edit"]),e.setEnum("singleAction",["this","help","dashboard","buy"]),e.setEnum("tpEnterance",["tp"]),e.setEnum("tpAction",["gui","set","clear"]),e.mandatory("action",ParamType.Enum,"encloseEnterance",1),e.mandatory("enclose",ParamType.Enum,"encloseAction",1),e.mandatory("action",ParamType.Enum,"singleAction",1),e.mandatory("action",ParamType.Enum,"tpEnterance",1),e.optional("tpaction",ParamType.Enum,"tpAction",1),e.overload(["encloseEnterance","encloseAction"]),e.overload(["tpEnterance","tpAction"]),e.overload(["singleAction"]),e.setCallback((e,n,t,a)=>{switch(n.player||outp.error(i18n.$t("command.notplayer")),a.action){case"enclose":CommandEncloseHander(n.player,a.enclose);break;case"this":CommandThisHander(n.player);break;case"tp":CommandTeleportHander(n.player,a.tpaction);break;case"buy":landResell(n.player);break;case"dashboard":DashBoardInit(n.player)}}),e.setup(),setTimeout(()=>{CheckUpdate()},5e3)}),mc.listen("onUseItemOn",function(n,t,a,e){logger.debug("onUseItemOn: block"+a.type),logger.debug("onUseItemOn item:"+t.type);var i=a.pos;let o=getPLandIdbyPos(i.x,i.y,i.z,i.dimid);if(o){var r=pLandDataInterface.data[o];if(pLandDataInterface.inTrust(n.xuid,o))return void logger.debug("onUseItemOn信任成员，放行行为");switch(a.type){case"minecraft:lectern":if(r.permissions.tools.useLectern)break;return!1;case"minecraft:bed":if(r.permissions.tools.useBed)break;return!1;case"minecraft:campfire":case"minecraft:soul_campfire":if(r.permissions.tools.useCampfire)break;return!1;case"minecraft:bell":if(r.permissions.tools.useBell)break;return!1;case"minecraft:crafting_table":if(r.permissions.tools.useCraftingTable)break;return!1;case"minecraft:cauldron":if(r.permissions.tools.useCauldron)break;return!1;case"minecraft:composter":if(r.permissions.tools.useComposter)break;return!1;case"minecraft:noteblock":if(r.permissions.tools.useNoteBlock)break;return!1;case"minecraft:jukebox":if(r.permissions.tools.useJukebox)break;return!1;case"minecraft:respawn_anchor":if(r.permissions.tools.useRespawnAnchor)break;return!1;case"minecraft:dragon_egg":if(r.permissions.blocks.blockDestory)break;return!1;case"minecraft:lever":if(r.permissions.redStone.useLever)break;return!1;case"minecraft:daylight_detector":case"minecraft:daylight_detector_inverted":if(r.permissions.redStone.useDaylightDetector)break;return!1;case"minecraft:unpowered_repeater":case"minecraft:powered_repeater":if(r.permissions.redStone.changeRepeater)break;return!1;case"minecraft:unpowered_comparator":case"minecraft:powered_comparator":if(r.permissions.redStone.changeComparator)break;return!1;case"minecraft:shulker_box":case"minecraft:undyed_shulker_box":if(r.permissions.container.openShulkerBox)break;return!1}switch(t.type){case"minecraft:bucket":case"minecraft:water_bucket":case"minecraft:lava_bucket":case"minecraft:cod_bucket":case"minecraft:tropical_fish_bucket":case"minecraft:powder_snow_bucket":case"minecraft:pufferfish_bucket":case"minecraft:axolotl_bucket":if(r.permissions.tools.useBucket)break;return!1;case"minecraft:armor_stand":if(r.permissions.tools.useArmorStand)break;return!1;case"minecraft:flint_and_steel":if(r.permissions.tools.useFlint)break;return!1;case"minecraft:glow_ink_sac":case"minecraft:ink_sac":case"minecraft:end_crystal":case"minecraft:ender_eye":if(r.permissions.blocks.blockPlace)break;return!1}let e=a.type;return e.endsWith("door")&&!r.permissions.blocks.openDoor?!1:!(e.endsWith("fence_gate")&&!r.permissions.blocks.useFenceGate)&&(!(e.endsWith("trapdoor")&&!r.permissions.blocks.useTrapdoor)&&(!(e.endsWith("button")&&!r.permissions.redStone.pressButton)&&(!(e.endsWith("minecart")&&!r.permissions.blocks.blockPlace)&&(!(e.endsWith("boat")&&!r.permissions.blocks.blockPlace)&&(!("minecraft:painting"===e&&!r.permissions.blocks.blockPlace)&&void 0)))))}if(enableOrg&&(o=getOLandIdbyPos(i.x,i.y,i.z,i.dimid))){var s=OlandDataInterface.data[o];if(!OlandDataInterface.inTrust(n.xuid,o)){switch(a.type){case"minecraft:lectern":if(s.permissions.tools.useLectern)break;return!1;case"minecraft:bed":if(s.permissions.tools.useBed)break;return!1;case"minecraft:campfire":case"minecraft:soul_campfire":if(s.permissions.tools.useCampfire)break;return!1;case"minecraft:bell":if(s.permissions.tools.useBell)break;return!1;case"minecraft:crafting_table":if(s.permissions.tools.useCraftingTable)break;return!1;case"minecraft:cauldron":if(s.permissions.tools.useCauldron)break;return!1;case"minecraft:composter":if(s.permissions.tools.useComposter)break;return!1;case"minecraft:noteblock":if(s.permissions.tools.useNoteBlock)break;return!1;case"minecraft:jukebox":if(s.permissions.tools.useJukebox)break;return!1;case"minecraft:respawn_anchor":if(s.permissions.tools.useRespawnAnchor)break;return!1;case"minecraft:dragon_egg":if(s.permissions.blocks.blockDestory)break;return!1;case"minecraft:lever":if(s.permissions.redStone.useLever)break;return!1;case"minecraft:daylight_detector":case"minecraft:daylight_detector_inverted":if(s.permissions.redStone.useDaylightDetector)break;return!1;case"minecraft:unpowered_repeater":case"minecraft:powered_repeater":if(s.permissions.redStone.changeRepeater)break;return!1;case"minecraft:unpowered_comparator":case"minecraft:powered_comparator":if(s.permissions.redStone.changeComparator)break;return!1;case"minecraft:shulker_box":case"minecraft:undyed_shulker_box":if(s.permissions.container.openShulkerBox)break;return!1}switch(t.type){case"minecraft:bucket":case"minecraft:water_bucket":case"minecraft:lava_bucket":case"minecraft:cod_bucket":case"minecraft:tropical_fish_bucket":case"minecraft:powder_snow_bucket":case"minecraft:pufferfish_bucket":case"minecraft:axolotl_bucket":if(s.permissions.tools.useBucket)break;return!1;case"minecraft:armor_stand":if(s.permissions.tools.useArmorStand)break;return!1;case"minecraft:flint_and_steel":if(s.permissions.tools.useFlint)break;return!1;case"minecraft:glow_ink_sac":case"minecraft:ink_sac":case"minecraft:end_crystal":case"minecraft:ender_eye":if(s.permissions.blocks.blockPlace)break;return!1}let e=a.type;return!(e.endsWith("door")&&!s.permissions.blocks.openDoor)&&(!(e.endsWith("fence_gate")&&!s.permissions.blocks.useFenceGate)&&(!(e.endsWith("trapdoor")&&!s.permissions.blocks.useTrapdoor)&&(!(e.endsWith("button")&&!s.permissions.redStone.pressButton)&&(!(e.endsWith("minecart")&&!s.permissions.blocks.blockPlace)&&(!(e.endsWith("boat")&&!s.permissions.blocks.blockPlace)&&(!("minecraft:painting"===e&&!s.permissions.blocks.blockPlace)&&void 0))))))}logger.debug("onUseItemOn信任成员，放行行为")}}),mc.listen("onBlockInteracted",function(e,n){logger.debug("onBlockInteracted:"+n.type);var t=n.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a){var i=pLandDataInterface.data[a];if(pLandDataInterface.inTrust(e.xuid,a))logger.debug("onBlockInteracted信任成员，放行行为");else switch(n.type){case"minecraft:cartography_table":if(i.permissions.tools.useCartographyTable)break;return!1;case"minecraft:smithing_table":if(i.permissions.tools.useSmithingTable)break;return!1;case"minecraft:smoker":if(i.permissions.tools.useSmoker)break;return!1;case"minecraft:furnace":if(i.permissions.tools.useFurnace)break;return!1;case"minecraft:blast_furnace":if(i.permissions.tools.useBlastFurnace)break;return!1;case"minecraft:brewing_stand":if(i.permissions.tools.useBrewingStand)break;return!1;case"minecraft:anvil":if(i.permissions.tools.useAnvil)break;return!1;case"minecraft:beacon":if(i.permissions.tools.useBeacon)break;return!1;case"minecraft:enchanting_table":if(i.permissions.tools.useEnchantingTable)break;return!1;case"minecraft:grindstone":if(i.permissions.tools.useGrindstone)break;return!1;case"minecraft:loom":if(i.permissions.tools.useLoom)break;return!1;case"minecraft:stonecutter_block":if(i.permissions.tools.useStonecutter)break;return!1}}else if(enableOrg&&(a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))){var o=OlandDataInterface.data[a];if(OlandDataInterface.inTrust(e.xuid,a))logger.debug("onBlockInteracted信任成员，放行行为");else switch(n.type){case"minecraft:cartography_table":if(o.permissions.tools.useCartographyTable)break;return!1;case"minecraft:smithing_table":if(o.permissions.tools.useSmithingTable)break;return!1;case"minecraft:smoker":if(o.permissions.tools.useSmoker)break;return!1;case"minecraft:furnace":if(o.permissions.tools.useFurnace)break;return!1;case"minecraft:blast_furnace":if(o.permissions.tools.useBlastFurnace)break;return!1;case"minecraft:brewing_stand":if(o.permissions.tools.useBrewingStand)break;return!1;case"minecraft:anvil":if(o.permissions.tools.useAnvil)break;return!1;case"minecraft:beacon":if(o.permissions.tools.useBeacon)break;return!1;case"minecraft:enchanting_table":if(o.permissions.tools.useEnchantingTable)break;return!1;case"minecraft:grindstone":if(o.permissions.tools.useGrindstone)break;return!1;case"minecraft:loom":if(o.permissions.tools.useLoom)break;return!1;case"minecraft:stonecutter_block":if(o.permissions.tools.useStonecutter)break;return!1}}}),mc.listen("onUseItem",(e,n)=>{logger.debug(n.type);var t=e.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a)return i=pLandDataInterface.data[a],pLandDataInterface.inTrust(e.xuid,a)?void logger.debug("onUseItem信任放行"):!("minecraft:bucket"===n.type&&!i.permissions.tools.useBucket)&&void 0;if(a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid)){var i=OlandDataInterface.data[a];if(!OlandDataInterface.inTrust(e.xuid,a))return!("minecraft:bucket"===n.type&&!i.permissions.tools.useBucket)&&void 0;logger.debug("onUseItem信任放行")}}),mc.listen("onOpenContainer",(e,n)=>{logger.debug(n.type);let t=n.type;n=n.pos;let a=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(a)return i=pLandDataInterface.data[a],pLandDataInterface.inTrust(e.xuid,a)?void logger.debug("onOpenContainer放行"):!("minecraft:dispenser"===t&&!i.permissions.redStone.useDispenser)&&(!("minecraft:dropper"===t&&!i.permissions.redStone.useDropper)&&(!("minecraft:hopper"===t&&!i.permissions.container.openHopper)&&(!("minecraft:barrel"===t&&!i.permissions.container.openBarrel)&&(!(t.endsWith("shulker_box")&&!i.permissions.container.openShulkerBox)&&(!(t.endsWith("chest")&&!i.permissions.container.openShulkerBox)&&void 0)))));if(enableOrg&&(a=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))){var i=OlandDataInterface.data[a];if(!OlandDataInterface.inTrust(e.xuid,a))return!("minecraft:dispenser"===t&&!i.permissions.redStone.useDispenser)&&(!("minecraft:dropper"===t&&!i.permissions.redStone.useDropper)&&(!("minecraft:hopper"===t&&!i.permissions.container.openHopper)&&(!("minecraft:barrel"===t&&!i.permissions.container.openBarrel)&&(!(t.endsWith("shulker_box")&&!i.permissions.container.openShulkerBox)&&(!(t.endsWith("chest")&&!i.permissions.container.openShulkerBox)&&void 0)))));logger.debug("onOpenContainer放行")}}),mc.listen("onStepOnPressurePlate",(e,n)=>{n=n.pos;let t=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(t)return!!pLandDataInterface.data[t].permissions.redStone.usePressurePlate&&void 0;if(enableOrg&&((t=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))&&!OlandDataInterface.data[t].permissions.redStone.usePressurePlate))return!1}),mc.listen("onHopperSearchItem",(e,n)=>{let t=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(t)return!!pLandDataInterface.data[t].permissions.redStone.HopperChange&&void 0;if(enableOrg&&((t=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[t].permissions.redStone.HopperChange))return!1}),mc.listen("onHopperPushOut",e=>{let n=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(n)return!!pLandDataInterface.data[n].permissions.redStone.HopperChange&&void 0;if(enableOrg&&((n=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[n].permissions.redStone.HopperChange))return!1}),mc.listen("onUseFrameBlock",(e,n)=>{n=n.pos;let t=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(t)return(pLandDataInterface.inTrust(e.xuid,t)||!!pLandDataInterface.data[t].permissions.redStone.HopperChange)&&void 0;if(enableOrg&&((t=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))&&!OlandDataInterface.inTrust(e.xuid,t)))return!!OlandDataInterface.data[t].permissions.redStone.HopperChange&&void 0}),mc.listen("onPlaceBlock",(e,n)=>{n=n.pos;let t=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(t)return(pLandDataInterface.inTrust(e.xuid,t)||!!pLandDataInterface.data[t].permissions.blocks.blockPlace)&&void 0;if(enableOrg&&((t=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))&&!OlandDataInterface.inTrust(e.xuid,t)))return!!OlandDataInterface.data[t].permissions.blocks.blockPlace&&void 0}),mc.listen("onDestroyBlock",(e,n)=>{n=n.pos;let t=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(t)return(pLandDataInterface.inTrust(e.xuid,t)||!!pLandDataInterface.data[t].permissions.blocks.blockDestory)&&void 0;if(enableOrg&&((t=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))&&!OlandDataInterface.inTrust(e.xuid,t)))return!!OlandDataInterface.data[t].permissions.blocks.blockDestory&&void 0}),mc.listen("onDropItem",(e,n)=>{var t=e.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a)return(pLandDataInterface.inTrust(e.xuid,a)||!!pLandDataInterface.data[a].permissions.blocks.itemDrop)&&void 0;if(enableOrg&&((a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))&&!OlandDataInterface.inTrust(e.xuid,a)))return!!OlandDataInterface.data[a].permissions.blocks.itemDrop&&void 0}),mc.listen("onTakeItem",(e,n,t)=>{n=n.pos;let a=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(a)return(pLandDataInterface.inTrust(e.xuid,a)||!!pLandDataInterface.data[a].permissions.blocks.itemDrop)&&void 0;if(enableOrg&&((a=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))&&!OlandDataInterface.inTrust(e.xuid,a)))return!!OlandDataInterface.data[a].permissions.blocks.itemDrop&&void 0});const entityDB={blockType:["minecraft:ender_crystal","minecraft:painting","minecraft:boat","minecraft:chest_minecart","minecraft:minecart","minecraft:hopper_minecart","minecraft:hopper_minecart","minecraft:tnt_minecart"],peaceful:["minecraft:axolotl","minecraft:bat","minecraft:cat","minecraft:chicken","minecraft:cod","minecraft:cow","minecraft:donkey","minecraft:fox","minecraft:glow_squid","minecraft:horse","minecraft:mooshroom","minecraft:mule","minecraft:ocelot","minecraft:parrot","minecraft:pig","minecraft:rabbit","minecraft:salmon","minecraft:snow_golem","minecraft:sheep","minecraft:skeleton_horse","minecraft:squid","minecraft:strider","minecraft:tropical_fish","minecraft:turtle","minecraft:villager_v2","minecraft:wandering_trader","minecraft:npc"],neutral:["minecraft:pufferfish","minecraft:bee","minecraft:dolphin","minecraft:goat","minecraft:iron_golem","minecraft:llama","minecraft:llama_spit","minecraft:wolf","minecraft:panda","minecraft:polar_bear","minecraft:enderman","minecraft:piglin","minecraft:zombie_pigman"],mob:["minecraft:blaze","minecraft:small_fireball","minecraft:creeper","minecraft:drowned","minecraft:elder_guardian","minecraft:endermite","minecraft:evocation_illager","minecraft:evocation_fang","minecraft:ghast","minecraft:spider","minecraft:cave_spider","minecraft:guardian","minecraft:hoglin","minecraft:husk","minecraft:magma_cube","minecraft:phantom","minecraft:pillager","minecraft:ravager","minecraft:shulker","minecraft:silverfish","minecraft:skeleton","minecraft:skeleton_horse","minecraft:slime","minecraft:vex","minecraft:vindicator","minecraft:witch","minecraft:wither_skeleton","minecraft:zoglin","minecraft:zombie","minecraft:zombie_villager_v2","minecraft:piglin_brute","minecraft:ender_dragon","minecraft:wither","minecraft:wither_skull","minecraft:wither_skull_dangerous"],projectile:["minecraft:fireball","minecraft:shulker_bullet","minecraft:dragon_fireball","minecraft:snowball","minecraft:fireworks_rocket","minecraft:thrown_trident","minecraft:arrow","minecraft:ender_pearl","minecraft:egg"]};function CommandTeleportHander(e,n){switch(n){case"set":CommandTpSetHander(e);break;case"clear":CommandTpClearHander(e);break;default:CommandTpGuiHander(e)}}function CommandTpSetHander(t){configAPI.data.common.allowLandTeleport||t.tell(i18n.$t("teleport.set.noPrem"));let a=t.blockPos,i=getPLandIdbyPos(a.x,a.y,a.z,a.dimid),o=getOLandIdbyPos(a.x,a.y,a.z,a.dimid),e=[0,0];configAPI.data.operator.includes(t.xuid)&&(e=[!!i,!!o]),i&&pLandDataInterface.data[i].settings.owner===t.xuid&&(e[0]=!0),o&&OlandDataInterface.data[o].settings.owner===orgAPI.getOrgNum(t.xuid)&&orgAPI.isOwner(t.xuid)&&(e[1]=!0),e[0]&&e[1]?t.sendModalForm(i18n.$t("teleport.set.title"),i18n.$t("teleport.set.desp"),i18n.$t("teleport.set.pri"),i18n.$t("teleport.set.org"),(e,n)=>{null!=n&&(n?(pLandDataInterface.data[i].teleport=[a.x,a.y,a.z],pLandDataInterface.save()):(OlandDataInterface.data[o].teleport=[a.x,a.y,a.z],OlandDataInterface.save()),t.tell(i18n.$t("teleport.set.success")))}):e[0]?(pLandDataInterface.data[i].teleport=[a.x,a.y,a.z],pLandDataInterface.save(),t.tell(i18n.$t("teleport.set.success"))):e[1]?(OlandDataInterface.data[o].teleport=[a.x,a.y,a.z],OlandDataInterface.save(),t.tell(i18n.$t("teleport.set.success"))):t.tell(i18n.$t("this.manage.noland"))}function CommandTpClearHander(t){configAPI.data.common.allowLandTeleport||t.tell(i18n.$t("teleport.set.noPrem"));var e=t.blockPos;let a=getPLandIdbyPos(e.x,e.y,e.z,e.dimid),i=getOLandIdbyPos(e.x,e.y,e.z,e.dimid),n=[0,0];configAPI.data.operator.includes(t.xuid)&&(n=[!!a,!!i]),a&&pLandDataInterface.data[a].settings.owner===t.xuid&&(n[0]=!0),i&&OlandDataInterface.data[i].settings.owner===orgAPI.getOrgNum(t.xuid)&&orgAPI.isOwner(t.xuid)&&(n[1]=!0),n[0]&&n[1]?t.sendModalForm(i18n.$t("teleport.set.title"),i18n.$t("teleport.set.desp"),i18n.$t("teleport.set.pri"),i18n.$t("teleport.set.org"),(e,n)=>{null!=n&&(n?(pLandDataInterface.data[a].teleport=[],pLandDataInterface.save()):(OlandDataInterface.data[i].teleport=[],OlandDataInterface.save()),t.tell(i18n.$t("teleport.clear.success")))}):n[0]?(pLandDataInterface.data[a].teleport=[],pLandDataInterface.save(),t.tell(i18n.$t("teleport.clear.success"))):n[1]?(OlandDataInterface.data[i].teleport=[],OlandDataInterface.save(),t.tell(i18n.$t("teleport.clear.success"))):t.tell(i18n.$t("this.manage.noland"))}function CommandTpGuiHander(e){configAPI.data.common.allowLandTeleport||e.tell(i18n.$t("teleport.set.noPrem"));let t=[],n=belongToApi.data.player[e.xuid];if(n)for(const s of n){var a=pLandDataInterface.data[s];0!==a.teleport.length&&t.push({isOrg:!1,name:a.settings.name,teleport:a.teleport,dim:a.range.dimid})}if(n=belongToApi.data.shared[e.xuid])for(const l of n){var i=pLandDataInterface.data[l];0!==i.teleport.length&&t.push({isOrg:!1,name:i.settings.name,teleport:i.teleport,dim:i.range.dimid})}if(enableOrg&&orgAPI.getOrgNum(e.xuid)&&(n=belongToApi.data.org[orgAPI.getOrgNum(e.xuid)]))for(const d of n){var o=OlandDataInterface.data[d];0!==o.teleport.length&&t.push({isOrg:!0,name:o.settings.name,teleport:o.teleport,dim:o.range.dimid})}let r=mc.newSimpleForm();r.setTitle(i18n.$t("teleport.gui.title"));for(const m of t)m.isOrg?r.addButton(i18n.$t("teleport.gui.Orgitem",[m.name])):r.addButton(i18n.$t("teleport.gui.Priitem",[m.name]));e.sendForm(r,(e,n)=>{null!=n&&(n=t[n],e.teleport(n.teleport[0],n.teleport[1],n.teleport[2],n.dim),e.tell(i18n.$t("teleport.gui.success")))})}function PistonPushBlock(e){let n=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);return n?!!pLandDataInterface.data[n].events.pistonPush:!enableOrg||((n=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))?!!OlandDataInterface.data[n].events.pistonPush:void 0)}function PistonMove(e){let n=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);return n?!!pLandDataInterface.data[n].permissions.redStone.pistonPush:!enableOrg||((n=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))?!!OlandDataInterface.data[n].permissions.redStone.pistonPush:void 0)}function LiquidFlowEvents(e){let n=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);return n?!!pLandDataInterface.data[n].events.liquidFlow:!configAPI.data.common.liquidFlow||((n=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))?!!OlandDataInterface.data[n].events.liquidFlow:void 0)}function ExplodeHander(e,n,t){return e.range.dimid!==n.dimid||(!!e.events.explode||(distance={nx:e.range.min_position[0]-n.x,px:n.x-e.range.max_position[0],nz:e.range.min_position[2]-n.z,pz:n.z-e.range.max_position[2],ny:e.range.min_position[1]-n.y,py:n.y-e.range.max_position[1]},!(!e.range.type2D||!(nx>t||px>t||nz>t||pz>t))||!e.range.type2D&&(nx>t||px>t||nz>t||pz>t||ny>t||py>t)))}function recycleLand(a,i,o){if(!configAPI.data.refund.enable)return e=mc.newSimpleForm().setTitle(i18n.$t("recycle.gui.title")).setContent(i18n.$t("recycle.noPrem")),void a.sendForm(e,(e,n)=>{ManageLand(e,i,o)});let r;var e=twoPosFormat((r=(o?OlandDataInterface:pLandDataInterface).data[i]).range.max_position,r.range.min_position);let s=0;s=r.range.type2D?e.dx*e.dz*configAPI.data.sell.type2D.priceSquare:configAPI.data.sell.type3D.priceY?e.dx*e.dz*configAPI.data.sell.type3D.priceXZ+e.dy*configAPI.data.sell.type3D.priceY:e.dx*e.dy*posInterfaces.dz*configAPI.data.sell.type3D.priceXZ,s=parseInt(s*configAPI.data.refund.rate),a.sendModalForm(i18n.$t("recycle.gui.title"),i18n.$t("recycle.gui.desp",[i,o?i18n.$t("this.manage.choose.org"):i18n.$t("this.manage.choose.pri"),r.settings.name,s]),i18n.$t("common.YES"),i18n.$t("common.NO"),(e,n)=>{if(null==n&&ManageLand(e,i,o),n)if(playerState[e.xuid].inOLand="",playerState[e.xuid].inPLand="",o)belongToApi.orgRemoveLand(r.settings.owner,i),ChunkInterface.unlinkOrg(r.range.min_position[0],r.range.max_position[0],r.range.min_position[2],r.range.max_position[2],r.range.dimid,i),delete OlandDataInterface.data[i],cache.clean(),belongToApi.save(),ChunkInterface.save(),OlandDataInterface.save(),orgAPI.orgAddMoney(r.settings.owner,s);else{belongToApi.playerRemoveLand(r.settings.owner,i);for(const t of r.share)belongToApi.playerRemoveShare(t,i);ChunkInterface.unlinkPrivate(r.range.min_position[0],r.range.max_position[0],r.range.min_position[2],r.range.max_position[2],r.range.dimid,i),delete pLandDataInterface.data[i],cache.clean(),belongToApi.save(),ChunkInterface.save(),pLandDataInterface.save(),moneyUni.addMoney(r.settings.owner,s)}n=mc.newSimpleForm().setTitle(i18n.$t("recycle.gui.title")).setContent(i18n.$t("recycle.gui.success"));a.sendForm(n,(e,n)=>{})})}function reEnclosingHander(e,n,t){let a;a=(t?OlandDataInterface:pLandDataInterface).data[n],playerState[e.xuid].state="reEnclosing",playerState[e.xuid].editingLand.landId=n,playerState[e.xuid].editingLand.isOrg=t,playerState[e.xuid].enclosure.posA=a.range.max_position,playerState[e.xuid].enclosure.posB=a.range.min_position,playerState[e.xuid].enclosure.dim=a.range.dimid}function ReEnclosingScan(t){let a=playerState[t.xuid].editingLand.landId,i,o=(i=(playerState[t.xuid].editingLand.isOrg?OlandDataInterface:pLandDataInterface).data[a],twoPosFormat(playerState[t.xuid].enclosure.posA,playerState[t.xuid].enclosure.posB));if(319<o.maxY&&(o.maxY=319),o.minY<-64&&(o.minY=-64),playerState[t.xuid].enclosure.type2D&&(o.minY=-64,o.maxY=319),o.dy=o.maxY-o.minY,configAPI.data.limit.allowDimension.includes(playerState[t.xuid].enclosure.dim)||configAPI.data.operator.includes(t.xuid)||t.tell(i18n.$t("enclose.confirm.dimensionNotAllow")),playerState[t.xuid].enclosure.type2D){var e=o.dx*o.dz;if(e>configAPI.data.limit.type2DSquare[1]||e<configAPI.data.limit.type2DSquare[0])return e=mc.newSimpleForm().setTitle(i18n.$t("enclose.confirm.over")).setContent(i18n.$t("enclose.confirm.2D.over",[e,configAPI.data.limit.type2DSquare[1],configAPI.data.limit.type2DSquare[0]])),void t.sendForm(e,()=>{})}else{var e=o.dx*o.dz*o.dz;if(e>configAPI.data.limit.type3DVolume[1]||e<configAPI.data.limit.type3DVolume[0])return e=mc.newSimpleForm().setTitle(i18n.$t("enclose.confirm.over")).setContent(i18n.$t("enclose.confirm.3D.over",[e,configAPI.data.limit.type3DVolume[1],configAPI.data.limit.type3DVolume[0]])),void t.sendForm(e,()=>{})}e=playerState[t.xuid].editingLand.isOrg?getPLandinRange(twoPosFormat(i.range.min_position,i.range.max_position),playerState[t.xuid].enclosure.dim,playerState[t.xuid].enclosure.type2D):[a];log(e);let n;if(enableOrg&&(n=getOLandConflict(o,playerState[t.xuid].enclosure.dim,playerState[t.xuid].enclosure.type2D,[playerState[t.xuid].editingLand.isOrg?a:"没有"],t,playerState[t.xuid].editingLand.isOrg)))return s=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.org",[n])),void t.sendForm(s,()=>{});if(n=getPLandConflict(o,playerState[t.xuid].enclosure.dim,playerState[t.xuid].enclosure.type2D,e))return s=mc.newSimpleForm().setTitle(i18n.$t("enclose.conflict.title")).setContent(i18n.$t("enclose.conflict.pri",[n])),void t.sendForm(s,()=>{});let r=0;r=playerState[t.xuid].enclosure.type2D?o.dx*o.dz*configAPI.data.sell.type2D.priceSquare:configAPI.data.sell.type3D.priceY?o.dx*o.dz*configAPI.data.sell.type3D.priceXZ+o.dy*configAPI.data.sell.type3D.priceY:o.dx*o.dy*o.dz*configAPI.data.sell.type3D.priceXZ;var s,e=twoPosFormat(i.range.min_position,i.range.max_position);let l=0,d=(l=i.range.type2D?e.dx*e.dz*configAPI.data.sell.type2D.priceSquare:configAPI.data.sell.type3D.priceY?e.dx*e.dz*configAPI.data.sell.type3D.priceXZ+e.dy*configAPI.data.sell.type3D.priceY:e.dx*e.dy*e.dz*configAPI.data.sell.type3D.priceXZ,r-l);d<0&&(d*=configAPI.data.refund.rate),playerState[t.xuid].editingLand.isOrg?moneyUni.get(t)<d&&orgAPI.orgGetMoney(i.settings.owner)<d?(s=mc.newSimpleForm().setTitle(i18n.$t("enclose.payment.title")).setContent(i18n.$t("enclose.payment.moneyNoEnough",[configAPI.data.economy.moneyName,d,moneyUni.get(t)])),t.sendForm(s,(e,n)=>{ManageLand(e,a,isOrg)})):moneyUni.get(t)<d?t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.ori",[d,orgAPI.orgGetMoney(i.settings.owner)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{null!=n&&n&&!orgAPI.orgAddMoney(i.settings.owner,-d)&&t.tell(i18n.$t("enclose.payment.error"))}):orgAPI.orgGetMoney(i.settings.owner)<d?t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.pri",[d,moneyUni.get(t)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{if(null!=n&&n){if(0<=d){if(!moneyUni.pay(t,d))return void t.tell(i18n.$t("enclose.payment.error"))}else if(!moneyUni.addMoney(t.xuid,-d))return void t.tell(i18n.$t("enclose.payment.error"));ReEncloseMain(e,a,playerState[t.xuid].editingLand.isOrg,o)}}):t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.choose",[d,moneyUni.get(t),orgAPI.orgGetMoney(i.settings.owner)]),i18n.$t("enclose.pay.self"),i18n.$t("enclose.pay.org"),(e,n)=>{if(null!=n)if(n){if(0<=d){if(!moneyUni.pay(t,d))return void t.tell(i18n.$t("enclose.payment.error"))}else if(!moneyUni.addMoney(t.xuid,-d))return void t.tell(i18n.$t("enclose.payment.error"));ReEncloseMain(e,a,playerState[t.xuid].editingLand.isOrg,o)}else orgAPI.orgAddMoney(i.settings.owner,-d)?ReEncloseMain(e,a,playerState[t.xuid].editingLand.isOrg,o):t.tell(i18n.$t("enclose.payment.error"))}):moneyUni.get(t)<d?(e=mc.newSimpleForm().setTitle(i18n.$t("enclose.payment.title")).setContent(i18n.$t("enclose.payment.moneyNoEnough",[configAPI.data.economy.moneyName,d,moneyUni.get(t)])),t.sendForm(e,()=>{})):t.sendModalForm(i18n.$t("enclose.payment.title"),i18n.$t("enclose.payment.pri",[d,moneyUni.get(t)]),i18n.$t("common.confirm"),i18n.$t("common.cancel"),(e,n)=>{null!=n&&n&&!moneyUni.pay(t,d)&&t.tell(i18n.$t("enclose.payment.error"))})}function ReEncloseMain(e,n,t,a){let i;i=(t?OlandDataInterface:pLandDataInterface).data[n];a={type2D:playerState[e.xuid].enclosure.type2D,dimid:i.range.dimid,min_position:[a.minX,a.minY,a.minZ],max_position:[a.maxX,a.maxY,a.maxZ]};t?(ChunkInterface.unlinkOrg(i.range.min_position[0],i.range.max_position[0],i.range.min_position[2],i.range.max_position[2],i.range.dimid,n),OlandDataInterface.data[n].range=a,ChunkInterface.linkOrg(n),OlandDataInterface.save()):(ChunkInterface.unlinkPrivate(i.range.min_position[0],i.range.max_position[0],i.range.min_position[2],i.range.max_position[2],i.range.dimid,n),pLandDataInterface.data[n].range=a,ChunkInterface.linkPrivate(n),pLandDataInterface.save()),configAPI.data.common.enableCache&&(ChunkInterface.save(),cache.clean()),e.tell(i18n.$t("reEnclosing.success")),playerState[e.xuid].state="playing","reEnclosing"===playerState[e.xuid].state&&(playerState[e.xuid].editingLand.landId="")}mc.listen("onAttackEntity",(e,n)=>{var t=n.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a){if(pLandDataInterface.inTrust(e.xuid,a))return;var i=pLandDataInterface.data[a];return entityDB.blockType.includes(n.type)&&!i.permissions.blocks.blockDestory?!1:!("minecraft:armor_stand"===n.type&&!i.permissions.tools.useArmorStand)&&(!("minecraft:player"===n.type&&!i.permissions.player.allowAttackPlayer)&&(!(entityDB.peaceful.includes(n.type)&&!i.permissions.player.allowAttackAnimal)&&(!(entityDB.neutral.includes(n.type)&&!i.permissions.player.allowAttackNeutral)&&(!(entityDB.mob.includes(n.type)&&!i.permissions.player.allowAttackMobs)&&void 0))))}if(enableOrg&&((a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))&&!OlandDataInterface.inTrust(e.xuid,a)))return i=OlandDataInterface.data[a],!(entityDB.blockType.includes(n.type)&&!i.permissions.blocks.blockDestory)&&(!("minecraft:armor_stand"===n.type&&!i.permissions.tools.useArmorStand)&&(!("minecraft:player"===n.type&&!i.permissions.player.allowAttackPlayer)&&(!(entityDB.peaceful.includes(n.type)&&!i.permissions.player.allowAttackAnimal)&&(!(entityDB.neutral.includes(n.type)&&!i.permissions.player.allowAttackNeutral)&&(!(entityDB.mob.includes(n.type)&&!i.permissions.player.allowAttackMobs)&&void 0)))))}),mc.listen("onRide",(e,n)=>{var t=n.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);var i=e.isPlayer(),e=e.toPlayer();if(a){if(i&&pLandDataInterface.inTrust(e.xuid,a))return;var o=pLandDataInterface.data[a];return i&&"minecraft:boat"===n.type&&o.permissions.player.allowUseBoat?void 0:!(i&&"minecraft:boat"===n.type&&!o.permissions.player.allowUseBoat)&&(i&&"minecraft:minecart"===n.type&&o.permissions.player.allowUseMinecart?void 0:!(i&&"minecraft:minecart"===n.type&&!o.permissions.player.allowUseMinecart)&&(!i&&"minecraft:boat"===n.type&&o.permissions.entity.allowUseBoat?void 0:!(!i&&"minecraft:boat"===n.type&&!o.permissions.entity.allowUseBoat)&&(!i&&"minecraft:minecart"===n.type&&o.permissions.entity.allowUseMinecart?void 0:!(!i&&"minecraft:minecart"===n.type&&!o.permissions.entity.allowUseMinecart)&&(!!o.permissions.entity.allowRideEntity&&void 0))))}if(enableOrg&&(a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))&&(!i||!OlandDataInterface.inTrust(e.xuid,a))){o=OlandDataInterface.data[a];if(!i||"minecraft:boat"!==n.type||!o.permissions.player.allowUseBoat)return!(i&&"minecraft:boat"===n.type&&!o.permissions.player.allowUseBoat)&&(i&&"minecraft:minecart"===n.type&&o.permissions.player.allowUseMinecart?void 0:!(i&&"minecraft:minecart"===n.type&&!o.permissions.player.allowUseMinecart)&&(i||"minecraft:boat"!==n.type||!o.permissions.entity.allowUseBoat?!(!i&&"minecraft:boat"===n.type&&!o.permissions.entity.allowUseBoat)&&(i||"minecraft:minecart"!==n.type||!o.permissions.entity.allowUseMinecart?!(!i&&"minecraft:minecart"===n.type&&!o.permissions.entity.allowUseMinecart)&&(!!o.permissions.entity.allowRideEntity&&void 0):void 0):void 0))}}),mc.listen("onMobHurt",(n,t,e)=>{if(t&&!t.isPlayer()){n=n.pos;let e=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(e)return a=pLandDataInterface.data[e],!((entityDB.mob.includes(t.type)||entityDB.neutral.includes(t.type))&&!a.permissions.entity.allowAttackEntity)&&void 0;if(enableOrg&&(e=getOLandIdbyPos(n.x,n.y,n.z,n.dimid))){var a=OlandDataInterface.data[e];if((entityDB.mob.includes(t.type)||entityDB.neutral.includes(t.type))&&!a.permissions.entity.allowAttackEntity)return!1}}}),mc.listen("onEat",(e,n)=>{var t=e.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a)return(pLandDataInterface.inTrust(e.xuid,a)||!!pLandDataInterface.data[a].permissions.player.eat)&&void 0;if(enableOrg&&((a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))&&!OlandDataInterface.inTrust(e.xuid,a)))return!!OlandDataInterface.data[a].permissions.player.eat&&void 0}),mc.listen("onProjectileCreated",(e,n)=>{var t=e.pos;let a=getPLandIdbyPos(t.x,t.y,t.z,t.dimid);if(a){var i=pLandDataInterface.data[a];if(!e.isPlayer())return!!i.permissions.entity.allowShoot&&void 0;var o=e.toPlayer();return pLandDataInterface.inTrust(o.xuid,a)?void 0:"minecraft:fishing_hook"===n.type?!!i.permissions.player.fishing&&void 0:"minecraft:splash_potion"===n.type||"minecraft:lingering_potion"===n.type?!!i.permissions.player.allowThrowPotion&&void 0:!!i.permissions.player.allowShoot&&void 0}if(enableOrg&&(a=getOLandIdbyPos(t.x,t.y,t.z,t.dimid))){o=OlandDataInterface.data[a];if(!e.isPlayer())return!!o.permissions.entity.allowShoot&&void 0;i=e.toPlayer();return OlandDataInterface.inTrust(i.xuid,a)?void 0:"minecraft:fishing_hook"===n.type?!!o.permissions.player.fishing&&void 0:"minecraft:splash_potion"===n.type||"minecraft:lingering_potion"===n.type?!!o.permissions.player.allowThrowPotion&&void 0:!!o.permissions.player.allowShoot&&void 0}}),mc.listen("onChangeArmorStand",(e,n,t)=>{e=e.pos;let a=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(a)return(pLandDataInterface.inTrust(n.xuid,a)||!!pLandDataInterface.data[a].permissions.tools.useArmorStand)&&void 0;if(enableOrg&&((a=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.inTrust(n.xuid,a)))return!!OlandDataInterface.data[a].permissions.tools.useArmorStand&&void 0}),mc.listen("onFireSpread",e=>{let n=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(n)return!!pLandDataInterface.data[n].events.fireSpread&&void 0;if(enableOrg&&((n=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[n].events.fireSpread))return!1}),mc.listen("onRedStoneUpdate",(e,n,t)=>{e=e.pos;let a=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(a)return!!pLandDataInterface.data[a].events.redstoneUpdate&&void 0;if(enableOrg&&((a=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[a].events.redstoneUpdate))return!1}),mc.listen("onRedStoneUpdate",(e,n,t)=>{e=e.pos;let a=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(a)return!!pLandDataInterface.data[a].events.redstoneUpdate&&void 0;if(enableOrg&&((a=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[a].events.redstoneUpdate))return!1}),mc.listen("onPistonTryPush",(e,n)=>{return PistonPushBlock(n.pos)&&PistonMove(e)}),mc.listen("onFarmLandDecay",(e,n)=>{let t=getPLandIdbyPos(e.x,e.y,e.z,e.dimid);if(t)return!!pLandDataInterface.data[t].events.redstoneUpdate&&void 0;if(enableOrg&&((t=getOLandIdbyPos(e.x,e.y,e.z,e.dimid))&&!OlandDataInterface.data[t].events.redstoneUpdate))return!1}),mc.listen("onLiquidFlow",(e,n)=>{return LiquidFlowEvents(e.pos)&&LiquidFlowEvents(n)}),mc.listen("onBlockExplode",(e,n,t,a,i,o)=>{if(enableOrg)for(const r of ChunkInterface.getChunksLand(n.x,n.z,n.dimid,!0))if(!ExplodeHander(OlandDataInterface.data[r],n,t))return!1;for(const s of ChunkInterface.getChunksLand(n.x,n.z,n.dimid,!1))if(!ExplodeHander(pLandDataInterface.data[s],n,t))return!1}),mc.listen("onEntityExplode",(e,n,t,a,i,o)=>{if(enableOrg)for(const r of ChunkInterface.getChunksLand(n.x,n.z,n.dimid,!0))if(!ExplodeHander(OlandDataInterface.data[r],n,t))return!1;for(const s of ChunkInterface.getChunksLand(n.x,n.z,n.dimid,!1))if(!ExplodeHander(pLandDataInterface.data[s],n,t))return!1}),mc.listen("onWitherBossDestroy",(e,n,t)=>{var a=e.pos;if(enableOrg)for(const i of ChunkInterface.getChunksLand(a.x,a.z,a.dimid,!0))if(!ExplodeHander(OlandDataInterface.data[i],a,16))return!1;for(const o of ChunkInterface.getChunksLand(a.x,a.z,a.dimid,!1))if(!ExplodeHander(pLandDataInterface.data[o],a,16))return!1});const playerDB={data:{},save(){file.writeTo("./plugins/js_data/landEX/playerDB.json",data.toJson(this.data))},reload(){this.data=data.parseJson(File.readFrom("./plugins/js_data/landEX/playerDB.json"))}};function playerSelector(e,o,r={},n=""){for(const e of mc.getOnlinePlayers())r[e.xuid]=e.realName;let t=mc.newCustomForm().setTitle(i18n.$t("manage.playerSelector.title")).addLabel(i18n.$t("manage.playerSelector.tips"));t.addInput(i18n.$t("manage.playerSelector.search"),i18n.$t("manage.playerSelector.searchInput"),n),t.addDropdown(i18n.$t("manage.playerSelector.choose"),Object.values(r)),e.sendForm(t,(n,t)=>{if(null==t)o(n,"");else if(""!==t[1]){let e={};for(const a in playerDB.data){const i=playerDB.data[a];i.includes(t[1])&&(e[a]=i)}0===Object.keys(e).length?playerSelector(n,o,r,t[1]):playerSelector(n,o,e,"")}else o(n,Object.keys(r)[t[2]])})}function changeOwnerHander(n,a,i){playerSelector(n,(e,t)=>{""===t?ManageLand(e,a,i):n.sendModalForm(i18n.$t("changeOwner.title"),i18n.$t("changeOwner.confirm",[data.xuid2name(t)]),i18n.$t("common.YES"),i18n.$t("common.NO"),(e,n)=>{n&&(n=pLandDataInterface.data[a].settings.owner,belongToApi.playerRemoveLand(n,a),belongToApi.playerAddShare(n,a),pLandDataInterface.data[a].settings.owner=t,belongToApi.data.shared[t]&&belongToApi.data.shared[t].includes(a)&&belongToApi.playerRemoveShare(t,a),belongToApi.playerAddLand(t,a),belongToApi.save(),pLandDataInterface.save(),e.tell(i18n.$t("changeOwner.success")))})})}function sharedManageHander(e,i,o){let r,n=(r=(o?OlandDataInterface:pLandDataInterface).data[i],mc.newSimpleForm().setTitle(i18n.$t("shared.title"))),t="";for(const a of r.share)t+=data.xuid2name(a)+"\n";n.setContent(i18n.$t("shared.desp",[t])),n.addButton(i18n.$t("shared.add"),"textures/blocks/build_allow"),0!==r.share.length&&n.addButton(i18n.$t("shared.remove"),"textures/blocks/build_deny"),e.sendForm(n,(n,e)=>{if(null==e)ManageLand(n,i,o);else if(1===e){let e=mc.newCustomForm().setTitle(i18n.$t("shared.title")),t={};for(const a of r.share)data.xuid2name(a)&&(t[a]=data.xuid2name(a));e.addDropdown(i18n.$t("shared.remove"),Object.values(t)),n.sendForm(e,(e,n)=>{null==n?sharedManageHander(e,i,o):(n=Object.keys(t)[n[0]],pLandDataInterface.data[i].share.splice(r.share.indexOf(n),1),belongToApi.playerRemoveShare(n,i),pLandDataInterface.save(),belongToApi.save(),n=mc.newSimpleForm().setTitle(i18n.$t("shared.title")).setContent(i18n.$t("shared.deleteSuccess")),e.sendForm(n,(e,n)=>{sharedManageHander(e,i,o)}))})}else 0===e&&playerSelector(n,(e,n)=>{var t;r.share.includes(n)?(t=mc.newSimpleForm().setTitle(i18n.$t("shared.title")).setContent(i18n.$t("shared.hasInclude")),e.sendForm(t,(e,n)=>{sharedManageHander(e,i,o)})):(pLandDataInterface.data[i].share.push(n),belongToApi.playerAddShare(n,i),pLandDataInterface.save(),belongToApi.save(),t=mc.newSimpleForm().setTitle(i18n.$t("shared.title")).setContent(i18n.$t("shared.success")),e.sendForm(t,(e,n)=>{sharedManageHander(e,i,o)}))})})}function landResellManager(t,a,i){var e=pLandDataInterface.data[a];let n=mc.newCustomForm().setTitle(i18n.$t("resell.title")).addLabel(i18n.$t("resell.desp"));n.addInput(i18n.$t("resell.setprice"),i18n.$t("resell.setpriceDesp"),e.resell?String(e.resell):""),t.sendForm(n,(e,n)=>{if(null==n)ManageLand(e,a,i);else{if(""===n[1])return delete pLandDataInterface.data[a].resell,pLandDataInterface.save(),e=mc.newSimpleForm().setTitle(i18n.$t("resell.title")).setContent(i18n.$t("resell.success")),void t.sendForm(e,(e,n)=>{ManageLand(e,a,i)});if(isNaN(n[1]))return e=mc.newSimpleForm().setTitle(i18n.$t("resell.title")).setContent(i18n.$t("resell.buy.isNaN")),void t.sendForm(e,(e,n)=>{landResellManager(e,a,i)});pLandDataInterface.data[a].resell=parseInt(n[1]),pLandDataInterface.save();e=mc.newSimpleForm().setTitle(i18n.$t("resell.title")).setContent(i18n.$t("resell.success"));t.sendForm(e,(e,n)=>{ManageLand(e,a,i)})}})}function landResell(e){var n=e.blockPos;let a=getPLandIdbyPos(n.x,n.y,n.z,n.dimid);if(a){let t=pLandDataInterface.data[a];t.resell?t.resell>moneyUni.get(e)?e.tell(i18n.$t("resell.buy.moneyNoEnough")):e.sendModalForm(i18n.$t("resell.title"),i18n.$t("resell.buy.desp",[t.resell,t.settings.name]),i18n.$t("common.YES"),i18n.$t("common.NO"),(e,n)=>{n&&(moneyUni.pay(e,t.resell),moneyUni.addMoney(pLandDataInterface.data[a].settings.owner,t.resell),pLandDataInterface.data[a].settings.owner=e.xuid,delete pLandDataInterface.data[a].resell,pLandDataInterface.save(),e.tell(i18n.$t("resell.buy.success")))}):e.tell(i18n.$t("resell.noforsell"))}else e.tell(i18n.$t("resell.noforsell"))}function DashBoardInit(n){if(configAPI.data.operator.includes(n.xuid)){let e=mc.newSimpleForm().setTitle(i18n.$t("dashboard.main.title"));e.addButton(i18n.$t("dashboard.main.byUUID"),"textures/items/amethyst_shard"),e.addButton(i18n.$t("dashboard.main.byPlayer"),"textures/items/netherite_helmet"),e.addButton(i18n.$t("dashboard.main.byOrgNum"),"textures/items/name_tag"),e.addButton(i18n.$t("dashboard.main.this"),"textures/items/map_filled"),n.sendForm(e,(n,i)=>{if(null!=i)switch(i){case 0:UUIDManage(n);break;case 1:playerSelector(n,(e,n)=>{n&&PlayerNameManage(e,n)});break;case 2:let s=Object.keys(belongToApi.data.org),e=mc.newSimpleForm().setTitle(i18n.$t("dashboard.main.title"));for(const r of s)e.addButton(i18n.$t("dashboard.org.item",[orgAPI.getOrgName(r),r]));n.sendForm(e,(n,a)=>{if(null==a)DashBoardInit(n);else{a=s[a];let t=[];a=belongToApi.data.org[a];if(a)for(const o of a){var i=OlandDataInterface.data[o];t.push({landId:o,name:i.settings.name})}let e=mc.newSimpleForm();e.setTitle(i18n.$t("dashboard.main.title"));for(const r of t)r.isOrg?e.addButton(i18n.$t("dashboard.gui.Orgitem",[r.name])):e.addButton(i18n.$t("dashboard.gui.Priitem",[r.name]));n.sendForm(e,(e,n)=>{ManageLand(e,t[n].landId,!0)})}});break;case 3:var o=n.blockPos;let t=getPLandIdbyPos(o.x,o.y,o.z,o.dimid),a=getOLandIdbyPos(o.x,o.y,o.z,o.dimid);o=[!!t,!!a];o[0]&&o[1]?n.sendModalForm(i18n.$t("this.manage.choose.title"),i18n.$t("this.manage.choose.desp"),i18n.$t("this.manage.choose.org"),i18n.$t("this.manage.choose.pri"),(e,n)=>{null!=n&&(n?ManageLand(e,a,!0):ManageLand(e,t,!1))}):o[0]?ManageLand(n,t,!1):o[1]?ManageLand(n,a,!0):n.tell(i18n.$t("this.manage.noland"))}})}else n.tell(i18n.$t("dashboard.noPrem"))}function PlayerNameManage(e,n){let t=[];n=belongToApi.data.player[n];if(n)for(const o of n){var a=pLandDataInterface.data[o];t.push({landId:o,name:a.settings.name})}let i=mc.newSimpleForm();i.setTitle(i18n.$t("dashboard.main.title"));for(const r of t)r.isOrg?i.addButton(i18n.$t("dashboard.gui.Orgitem",[r.name])):i.addButton(i18n.$t("dashboard.gui.Priitem",[r.name]));e.sendForm(i,(e,n)=>{null==n?DashBoardInit(e):ManageLand(e,t[n].landId,!1)})}function UUIDManage(i){let e=mc.newCustomForm().setTitle(i18n.$t("dashboard.main.title"));e.addInput(i18n.$t("dashboard.uuid.label")),e.addSwitch(i18n.$t("dashboard.uuid.isOrg")),i.sendForm(e,(e,n)=>{var t,a;{if(null!=n)return a=!!n[1],n=n[0],a&&!OlandDataInterface.data[n]||!a&&!pLandDataInterface.data[n]?(t=mc.newSimpleForm().setTitle(i18n.$t("dashboard.main.title")).setContent(i18n.$t("dashboard.uuid.nofound")),void i.sendForm(t,(e,n)=>{UUIDManage(e)})):void ManageLand(e,n,a);DashBoardInit(e)}})}file.exists("./plugins/js_data/landEX/playerDB.json")?configAPI.reload():configAPI.save(),mc.regConsoleCmd("landex","公会EX",e=>{if(e[0])switch(e[0]){case"op":if(!e[1])return void log(i18n.$t("console.error"));var n=data.name2xuid(e[1]);if(!n)return void log(i18n.$t("console.opNoPlayer"));if(!configAPI.data.operator.includes(n))return configAPI.data.operator.push(n),configAPI.save(),void log(i18n.$t("console.opPlayer",[e[1],n]));log(i18n.$t("console.noFinish",[e[1],n]));break;case"deop":if(!e[1])return void log(i18n.$t("console.error"));n=data.name2xuid(e[1]);if(!n)return void log(i18n.$t("console.opNoPlayer"));if(configAPI.data.operator.includes(n))return configAPI.data.operator.splice(configAPI.data.operator.indexOf(n),1),configAPI.save(),void log(i18n.$t("console.deopPlayer",[e[1],n]));log(i18n.$t("console.noFinish",[e[1],n]));break;default:log(i18n.$t("console.error"))}else log(i18n.$t("console.error"))}),logger.log("欢迎使用LandEX!\n##          ###    ##    ## ########  ######## ##     ##\n##         ## ##   ###   ## ##     ## ##        ##   ##\n##        ##   ##  ####  ## ##     ## ##         ## ##\n##       ##     ## ## ## ## ##     ## ######      ###    \n##       ######### ##  #### ##     ## ##         ## ##   \n##       ##     ## ##   ### ##     ## ##        ##   ##  \n######## ##     ## ##    ## ########  ######## ##     ## ");const version=1;function CheckUpdate(){network.httpGet("http://static.vory.work/update.json",function(e,n){if(200!==e)return logger,void info(i18n.$t("update.networkError"));e=data.parseJson(n);e.version>version&&(logger.warn(i18n.$t("update.notify")),logger.warn(e.log))})}